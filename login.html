<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sign in ‚Äî ScaleVest</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* BASE STYLES */
*{box-sizing:border-box;font-family: 'Inter', sans-serif;}
body{margin:0;color:#111827;overflow-x:hidden; background: #000;}

#bgVideo{
    position:fixed; inset:0; width:100%; height:100%; object-fit:cover; z-index:-2;
}
body::before{
    content:""; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:-1;
}

/* AUTH BUTTONS */
.auth-btn{
    display:flex; align-items:center; justify-content:center; gap:12px;
    width:100%; padding:12px 16px; margin-bottom:12px;
    border-radius:8px; border:1px solid #e5e7eb;
    background:#fff; font-weight:600; cursor:pointer;
    color:#374151; font-size:14px; transition: all 0.2s;
}
.auth-btn:hover{ background:#f9fafb; border-color: #d1d5db; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }

.btn-google {
    border: 2px solid transparent;
    background-image: linear-gradient(white, white), 
                      linear-gradient(to right, #4285F4, #EA4335, #FBBC05, #34A853);
    background-origin: border-box;
    background-clip: padding-box, border-box;
}
.auth-btn img { width: 18px; height: 18px; }

/* MODALS */
.modal-overlay, .email-overlay {
    position:fixed; inset:0; display:flex; justify-content:center; align-items:center; z-index: 50; padding: 20px;
}
.email-overlay { background:rgba(0,0,0,0.8); display:none; z-index:100; overflow-y: auto; }

.modal-content-prof {
    width:100%; max-width:400px; padding:32px; border-radius:12px;
    background:#ffffff; color:#111827;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    text-align: center;
}

/* MAIN CONTAINER RESPONSIVENESS */
.modal {
    width:100%; max-width:900px; height: auto; min-height:520px; 
    background:#fff; border-radius:16px; display:flex; overflow:hidden;
}
.modal-left {
    width: 50%; background: url('scalevestauth.png') no-repeat center center;
    background-size: cover; display: flex; align-items: flex-end; padding: 40px;
    color: #fff; position: relative; z-index: 1;
}
.modal-left::before {
    content: ""; position: absolute; inset: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%); z-index: -1;
}
.modal-right { width:50%; padding:40px; display: flex; flex-direction: column; justify-content: center; text-align: left;}

@media (max-width: 768px) {
    .modal { flex-direction: column; max-width: 450px; height: auto; }
    .modal-left { width: 100%; height: 180px; padding: 20px; }
    .modal-right { width: 100%; padding: 30px 20px; }
}

/* FORM STYLES */
.input-group { margin-bottom: 16px; text-align: left; }
.input-group label { display: block; font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 4px; }
input, select {
    width:100%; padding:10px 12px; border-radius:6px; border: 1px solid #d1d5db; font-size:14px; outline: none;
}
.phone-row { display: flex; gap: 8px; }
.phone-row select { width: 100px; }

.divider { text-align:center; margin:20px 0; position:relative; }
.divider span { background:#fff; padding:0 12px; font-size:12px; color:#9ca3af; }
.divider::before { content:""; position:absolute; top:50%; left:0; right:0; height:1px; background:#f3f4f6; z-index:-1; }

.error-msg {
    background:#fef2f2; border:1px solid #fee2e2; color:#b91c1c;
    padding:10px; border-radius:6px; font-size:13px; margin-bottom:16px; display:none;
}
</style>
</head>

<body>

<video id="bgVideo" autoplay muted loop playsinline>
    <source src="loginpage.mp4" type="video/mp4">
</video>

<div class="modal-overlay" id="mainOverlay">
    <div class="modal">
        <div class="modal-left">
            <div style="position: relative; z-index: 2;">
                <h2 style="font-size:32px; margin-bottom:10px; font-weight: 700; letter-spacing: -0.5px;">ScaleVest</h2>
                <p style="opacity:0.9; font-size: 14px; font-weight: 500;">Verified ‚Ä¢ Secure ‚Ä¢ Scalable</p>
            </div>
        </div>

        <div class="modal-right">
            <h3 style="margin-top:0; font-size: 22px;">Get Started</h3>
            <p style="color: #6b7280; font-size: 14px; margin-bottom: 24px;">Join thousands of businesses today.</p>

            <button class="auth-btn btn-google" onclick="googleLogin()">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                Continue with Google
            </button>

            <div class="divider"><span>or</span></div>

            <button class="auth-btn" onclick="emailAuthHandler()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                Continue with Email
            </button>
            
            <p style="text-align:center; font-size:13px; margin-top:20px;">
                Already have an account? <span style="color:#2563eb; font-weight:600; cursor:pointer;" onclick="switchToSigninUI()">Sign in</span>
            </p>
        </div>
    </div>
</div>

<div class="email-overlay" id="signupModal">
    <div class="modal-content-prof">
        <h3>Create Account</h3>
        <p>Enter your details to continue.</p>
        <div class="error-msg" id="signupError"></div>
        <div class="input-group">
            <label>Email Address</label>
            <input id="signupEmail" type="email" placeholder="name@company.com">
        </div>
        <div class="input-group">
            <label>Password</label>
            <input id="signupPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" oninput="checkPasswordRules()">
        </div>
        <ul style="color:#6b7280; font-size:11px; text-align: left; list-style:none; padding:0; margin-bottom:20px;">
            <li id="rule_length">‚ùå 6+ Characters</li>
            <li id="rule_number">‚ùå One Number</li>
            <li id="rule_special">‚ùå One Special Character</li>
        </ul>
        <button class="auth-btn" style="background:#2563eb; color:#fff; border:none;" onclick="emailSignup()">Continue</button>
        <button class="auth-btn" style="background:transparent; color:#6b7280; border:none;" onclick="closeModals()">Cancel</button>
    </div>
</div>

<div class="email-overlay" id="mobileModal">
    <div class="modal-content-prof">
        <h3>Verify Phone</h3>
        <p>Security verification required.</p>
        <div class="error-msg" id="mobileError"></div>
        <div class="input-group">
            <label>Mobile Number</label>
            <div class="phone-row">
                <select id="countryCode">
                    <option value="+1">üá∫üá∏ +1</option>
                    <option value="+44">üá¨üáß +44</option>
                    <option value="+91">üáÆüá≥ +91</option>
                    <option value="+971">üá¶üá™ +971</option>
                </select>
                <input id="mobileNumber" type="tel" placeholder="000 000 0000">
            </div>
        </div>
        <div id="recaptcha-container"></div>
        <button class="auth-btn" style="background:#2563eb; color:#fff; border:none;" onclick="sendOTP()">Send OTP</button>
        <button class="auth-btn" style="background:transparent; color:#6b7280; border:none;" onclick="cancelFlow()">Cancel</button>
    </div>
</div>

<div class="email-overlay" id="otpModal">
    <div class="modal-content-prof">
        <h3>Enter OTP</h3>
        <div class="error-msg" id="otpError"></div>
        <input id="otpCode" type="number" placeholder="000000" style="text-align:center; font-size:24px; letter-spacing:4px; margin-bottom:20px;">
        <button class="auth-btn" style="background:#10b981; color:#fff; border:none;" onclick="verifyOTPAndSignup()">Verify & Create</button>
        <button class="auth-btn" style="background:transparent; color:#6b7280; border:none;" onclick="cancelFlow()">Cancel Registration</button>
    </div>
</div>

<div class="email-overlay" id="signinModal">
    <div class="modal-content-prof">
        <h3>Welcome Back</h3>
        <div class="error-msg" id="signinError"></div>
        <div class="input-group">
            <label>Email</label>
            <input id="signinEmail" type="email" placeholder="email@address.com">
        </div>
        <div class="input-group">
            <label>Password</label>
            <input id="signinPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <button class="auth-btn" style="background:#2563eb; color:#fff; border:none;" onclick="emailSignin()">Sign In</button>
        <p style="margin: 10px 0;"><span style="color: #2563eb; font-size: 13px; cursor: pointer;" onclick="handleForgotPassword()">Forgot password?</span></p>
        <button class="auth-btn" style="background:transparent; color:#6b7280; border:none;" onclick="closeModals()">Cancel</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
firebase.initializeApp({
    apiKey: "AIzaSyD6PdrKp2XLfRqjC587lMpdKTaWD4MBens",
    authDomain: "scalevest-163a0.firebaseapp.com",
    projectId: "scalevest-163a0"
});

const auth = firebase.auth();
let confirmationResult = null;
window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { 'size': 'invisible' });

// Handle page refresh persistence
window.onload = () => {
    if(localStorage.getItem('authStep') === 'OTP_PENDING') {
        otpModal.style.display = "flex";
    }
};

function emailAuthHandler(){ signupModal.style.display="flex"; }
function switchToSigninUI(){ closeModals(); signinModal.style.display="flex"; }
function closeModals(){ document.querySelectorAll('.email-overlay').forEach(el => el.style.display='none'); }
function cancelFlow() { localStorage.clear(); closeModals(); }

function checkPasswordRules(){
    const p = signupPassword.value;
    document.getElementById('rule_length').innerHTML = (p.length>=6 ? "‚úÖ":"‚ùå") + " 6+ Characters";
    document.getElementById('rule_number').innerHTML = (/\d/.test(p) ? "‚úÖ":"‚ùå") + " One Number";
    document.getElementById('rule_special').innerHTML = (/[!@#$%^&*]/.test(p) ? "‚úÖ":"‚ùå") + " One Special Character";
}

async function emailSignup() {
    const email = signupEmail.value.trim();
    const pass = signupPassword.value;
    if(!email || pass.length < 6) return;
    localStorage.setItem('tempEmail', email);
    localStorage.setItem('tempPass', pass);
    signupModal.style.display = "none";
    mobileModal.style.display = "flex";
}

async function sendOTP() {
    const code = document.getElementById('countryCode').value;
    const num = document.getElementById('mobileNumber').value.trim();
    try {
        confirmationResult = await auth.signInWithPhoneNumber(code + num, window.recaptchaVerifier);
        localStorage.setItem('authStep', 'OTP_PENDING');
        mobileModal.style.display = "none";
        otpModal.style.display = "flex";
    } catch (err) { alert(err.message); }
}

async function verifyOTPAndSignup() {
    try {
        await confirmationResult.confirm(otpCode.value);
        await auth.createUserWithEmailAndPassword(localStorage.getItem('tempEmail'), localStorage.getItem('tempPass'));
        localStorage.clear();
        window.location.href = "business-side.html";
    } catch (err) { alert("Invalid OTP"); }
}

async function emailSignin() {
    try {
        await auth.signInWithEmailAndPassword(signinEmail.value, signinPassword.value);
        window.location.href = "mainbusinesshub.html";
    } catch (err) { 
        const errEl = document.getElementById('signinError');
        errEl.innerText = err.message;
        errEl.style.display = "block";
    }
}

async function handleForgotPassword() {
    const email = signinEmail.value.trim();
    const errEl = document.getElementById('signinError');
    if (!email) {
        errEl.innerText = "Enter email first.";
        errEl.style.display = "block";
        return;
    }
    try {
        await auth.sendPasswordResetEmail(email);
        errEl.style.background = "#ecfdf5"; errEl.style.color = "#047857"; errEl.style.borderColor = "#10b981";
        errEl.innerText = "Reset link sent! Check your inbox.";
        errEl.style.display = "block";
    } catch (err) { alert(err.message); }
}

async function googleLogin() {
    const provider = new firebase.auth.GoogleAuthProvider();
    await auth.signInWithPopup(provider);
    window.location.href = "mainbusinesshub.html";
}
</script>
</body>
</html>
