<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Founder Dashboard</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', 'Segoe UI', sans-serif;
    background: #000;
    color: #fff;
    min-height: 100vh;
    padding: 20px;
}

.container {
    max-width: 900px;
    margin: 0 auto;
}

.header {
    text-align: center;
    margin-bottom: 60px;
}

.header h1 {
    font-size: 2.8rem;
    font-weight: 800;
    color: #fff;
    margin-bottom: 10px;
    letter-spacing: -1px;
}

.header h1 svg {
    width: 50px;       
    height: 50px;     
    margin-right: 15px; 
    vertical-align: middle;
}
.header p {
    color: #888;
    font-size: 1.1rem;
}

/* Roadmap Progress */
.roadmap {
    display: flex;
    justify-content: space-between;
    margin-bottom: 50px;
    position: relative;
    padding: 20px 0;
}

.roadmap::before {
    content: '';
    position: absolute;
    top: 35px;
    left: 8%;
    right: 8%;
    height: 2px;
    background: #222;
    z-index: 0;
}

.step-indicator {
    display: flex;
    flex-direction: column;
    align-items: center;
    z-index: 1;
    flex: 1;
}

.step-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #111;
    border: 2px solid #333;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    margin-bottom: 10px;
    transition: all 0.3s ease;
    color: #666;
}

.step-indicator.active .step-circle {
    background: #fff;
    border-color: #fff;
    color: #000;
    transform: scale(1.15);
}

.step-indicator.completed .step-circle {
    background: #fff;
    border-color: #fff;
    color: #000;
}

.step-label {
    font-size: 0.8rem;
    text-align: center;
    color: #555;
    font-weight: 500;
}

.step-indicator.active .step-label {
    color: #fff;
    font-weight: 700;
}

/* Form Card */
.form-card {
    background: #0a0a0a;
    border-radius: 16px;
    padding: 50px 60px;
    box-shadow: 0 20px 60px rgba(255, 255, 255, 0.03);
    border: 1px solid #1a1a1a;
}

.step-content {
    display: none;
}

.step-content.active {
    display: block !important;
    animation: fadeIn 0.4s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.step-title {
    font-size: 1.8rem;
    font-weight: 800;
    margin-bottom: 10px;
    color: #fff;
}

.step-subtitle {
    color: #888;
    margin-bottom: 40px;
    font-size: 1rem;
}

/* Form Groups */
.form-group {
    margin-bottom: 30px;
}

label {
    display: block;
    margin-bottom: 10px;
    font-weight: 600;
    color: #fff;
    font-size: 0.95rem;
}

.char-limit {
    color: #666;
    font-size: 0.85rem;
    font-weight: 400;
    margin-left: 8px;
}

input, textarea, select {
    width: 100%;
    padding: 16px 20px;
    background: #000;
    border: 2px solid #222;
    border-radius: 12px;
    color: #fff;
    font-size: 1rem;
    transition: all 0.3s ease;
    font-family: inherit;
}

input:focus, textarea:focus, select:focus {
    outline: none;
    border-color: #fff;
    background: #050505;
}

textarea {
    resize: vertical;
    min-height: 120px;
    line-height: 1.6;
}

.problem-solution-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
}

.square-box {
    background: #000;
    border: 2px solid #222;
    border-radius: 12px;
    padding: 20px;
    min-height: 180px;
}

.square-box label {
    font-size: 0.9rem;
    color: #888;
    margin-bottom: 12px;
}

.square-box textarea {
    background: transparent;
    border: none;
    padding: 0;
    min-height: 120px;
    color: #fff;
}

.square-box textarea:focus {
    border: none;
    outline: none;
}

.equity-fund-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

/* File Upload */
.file-upload {
    border: 2px dashed #333;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #000;
}

.file-upload:hover {
    border-color: #fff;
    background: #050505;
}

.file-upload input {
    display: none;
}

.file-upload-icon {
    width: 50px;
    height: 50px;
    margin: 0 auto 15px;
}

.file-name {
    color: #fff;
    margin-top: 15px;
    font-weight: 600;
}

/* Radio/Select Groups */
.radio-group {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.radio-item {
    flex: 1;
    min-width: 120px;
}

.radio-item input[type="radio"] {
    display: none;
}

.radio-item label {
    display: block;
    padding: 15px 20px;
    background: #000;
    border: 2px solid #222;
    border-radius: 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: 600;
}

.radio-item input[type="radio"]:checked + label {
    background: #fff;
    color: #000;
    border-color: #fff;
}

.radio-item label:hover {
    border-color: #444;
}

/* Buttons */
.buttons {
    display: flex;
    gap: 15px;
    margin-top: 50px;
}

button {
    flex: 1;
    padding: 18px 30px;
    border: none;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: inherit;
}

.btn-next {
    background: #fff;
    color: #000;
}

.btn-next:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(255, 255, 255, 0.2);
}

.btn-draft {
    background: #1a1a1a;
    color: #fff;
    border: 2px solid #333;
}

.btn-draft:hover {
    background: #222;
    border-color: #444;
}

.btn-back {
    background: transparent;
    color: #fff;
    border: 2px solid #333;
}

.btn-back:hover {
    background: #111;
    border-color: #444;
}

.btn-launch {
    background: #fff;
    color: #000;
}

.btn-launch:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(255, 255, 255, 0.3);
}

/* Celebration */
.celebration {
    display: none;
    text-align: center;
    padding: 80px 40px;
}

.celebration.active {
    display: block;
    animation: fadeIn 0.5s ease;
}

.celebration h2 {
    font-size: 2.5rem;
    margin-bottom: 15px;
    color: #fff;
    font-weight: 800;
}

.celebration p {
    color: #888;
    font-size: 1.1rem;
    margin-bottom: 40px;
}

.dashboard-btn {
    display: inline-block;
    padding: 18px 50px;
    background: #fff;
    color: #000;
    text-decoration: none;
    border-radius: 12px;
    font-weight: 700;
    transition: all 0.3s ease;
    font-size: 1.1rem;
}

.dashboard-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(255, 255, 255, 0.3);
}

.required {
    color: #fff;
}

/* Loading Screen */
.loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.loading-screen.hidden {
    display: none;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #222;
    border-top: 4px solid #fff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Co-founder inputs */
.cofounder-inputs {
    display: none;
    margin-top: 20px;
    padding: 20px;
    background: #000;
    border: 2px solid #222;
    border-radius: 12px;
}

.cofounder-inputs.show {
    display: block;
}

.cofounder-item {
    margin-bottom: 20px;
    padding: 20px;
    background: #050505;
    border: 1px solid #1a1a1a;
    border-radius: 10px;
}

/* Responsive */
@media (max-width: 768px) {
    .form-card {
        padding: 30px 25px;
    }
    
    .problem-solution-grid,
    .equity-fund-row {
        grid-template-columns: 1fr;
    }
    
    .header h1 {
        font-size: 2rem;
    }
    
    .buttons {
        flex-direction: column;
    }
}

        button {
            flex: 1;
            padding: 14px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-next {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            color: #fff;
        }

        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 0, 110, 0.3);
        }

        .btn-draft {
            background: #333;
            color: #fff;
        }
.loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #0a0a0a;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.loading-screen.hidden {
    display: none;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #333;
    border-top: 4px solid #fff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}
/* ============================================ */
/* COMPLETION POPUP STYLES */
/* ============================================ */

.completion-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 999999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s ease;
}

.completion-popup.show {
    opacity: 1;
    visibility: visible;
}

.completion-popup-content {
    position: relative;
    background: #0a0a0a;
    border: 1px solid #333;
    border-radius: 20px;
    width: 90%;
    max-width: 550px;
    box-shadow: 0 25px 60px rgba(255, 255, 255, 0.1);
    transform: scale(0.9) translateY(20px);
    transition: transform 0.4s ease;
}

.completion-popup.show .completion-popup-content {
    transform: scale(1) translateY(0);
}

.popup-close {
    position: absolute;
    top: 20px;
    right: 20px;
    background: transparent;
    border: none;
    color: #888;
    font-size: 2.5rem;
    line-height: 1;
    cursor: pointer;
    transition: all 0.2s;
    z-index: 10;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.popup-close:hover {
    color: #fff;
    transform: scale(1.1) rotate(90deg);
}

.popup-btn-draft,
.popup-btn-launch {
    flex: 1;
    padding: 1rem 2rem;
    border: none;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: inherit;
}

.popup-btn-draft {
    background: #1a1a1a;
    color: #fff;
    border: 2px solid #333;
}

.popup-btn-draft:hover {
    background: #222;
    border-color: #fff;
    transform: translateY(-2px);
}

.popup-btn-launch {
    background: linear-gradient(135deg, #10b981, #3a86ff);
    color: #fff;
}

.popup-btn-launch:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
}

/* Bounce In Animation */
@keyframes bounceIn {
    0% {
        transform: scale(0);
        opacity: 0;
    }
    50% {
        transform: scale(1.1);
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .completion-popup-content {
        width: 95%;
        max-width: none;
    }
    
    .popup-btn-draft,
    .popup-btn-launch {
        padding: 0.9rem 1.5rem;
        font-size: 0.95rem;
    }
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
        .btn-draft:hover {
            background: #444;
        }

        .btn-back {
            background: #222;
            color: #fff;
        }

        .btn-back:hover {
            background: #333;
        }

        .btn-launch {
            background: linear-gradient(135deg, #10b981, #3a86ff);
            color: #fff;
        }

        .btn-launch:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
        }

        .celebration {
            display: none;
            text-align: center;
            padding: 60px;
        }

        .celebration.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .celebration svg {
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .celebration h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #10b981, #3a86ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .dashboard-btn {
            display: inline-block;
            margin-top: 30px;
            padding: 14px 40px;
            background: linear-gradient(135deg, #ff006e, #8338ec);
            color: #fff;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .dashboard-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 0, 110, 0.3);
        }

        .required {
            color: #ff006e;
        }

        .equity-suffix {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
/* --- SPECIAL UPLOAD ANIMATION --- */
.special-upload-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.92);
    backdrop-filter: blur(15px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 99999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s ease;
}

.special-upload-overlay.active {
    opacity: 1;
    visibility: visible;
}

.pulse-ring {
    width: 80px; height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #ff006e, #8338ec);
    position: relative;
    animation: pulse-glow 2s infinite;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 30px rgba(255, 0, 110, 0.5);
    margin-bottom: 2rem;
}

.pulse-ring svg { width: 40px; height: 40px; stroke: #fff; }

@keyframes pulse-glow {
    0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 0, 110, 0.7); }
    70% { transform: scale(1); box-shadow: 0 0 0 20px rgba(255, 0, 110, 0); }
    100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 0, 110, 0); }
}

.upload-status-text {
    font-size: 1.5rem; font-weight: 700;
    background: linear-gradient(90deg, #fff, #aaa);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 0.5rem;
}

/* --- NEW PITCH DECK CARD STYLES --- */
.pitch-deck-row {
    display: flex;
    align-items: center;
    background: #111;
    border: 1px solid #333;
    border-radius: 12px;
    padding: 1.5rem;
    gap: 1.5rem;
    transition: all 0.3s;
}

.pitch-deck-row:hover {
    border-color: #555;
    background: #161616;
}

.pdf-thumbnail-container {
    width: 80px; height: 110px;
    background: #222;
    border-radius: 6px;
    overflow: hidden;
    flex-shrink: 0;
    border: 1px solid #444;
    position: relative;
}

.pdf-thumbnail-container canvas {
    width: 100%; height: 100%;
    object-fit: cover;
}

.pdf-details {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.pdf-filename {
    font-size: 1.1rem; font-weight: 600; color: #fff;
    margin-bottom: 0.25rem;
    display: flex; align-items: center; gap: 8px;
}

.pdf-filesize {
    font-size: 0.85rem; color: #888;
}

.open-pitch-btn {
    background: #fff;
    color: #000;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.2s;
    white-space: nowrap;
}

.open-pitch-btn:hover {
    transform: scale(1.05);
    background: #f0f0f0;
}

/* --- FULL SCREEN VIEWER --- */
.full-screen-viewer {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: #0a0a0a;
    z-index: 999999;
    display: flex;
    flex-direction: column;
    opacity: 0; pointer-events: none;
    transition: opacity 0.3s ease;
}

.full-screen-viewer.active {
    opacity: 1; pointer-events: all;
}

.viewer-header {
    height: 60px;
    background: #111;
    border-bottom: 1px solid #333;
    display: flex;
    align-items: center;
    padding: 0 2rem;
    justify-content: space-between;
}

.viewer-back-btn {
    display: flex; align-items: center; gap: 0.5rem;
    background: none; border: none; color: #fff;
    font-size: 1rem; font-weight: 600; cursor: pointer;
}

.viewer-back-btn:hover { color: #ccc; }

.viewer-content {
    flex: 1;
    width: 100%;
    background: #000;
}
        .equity-suffix label {
            margin: 0;
        }
    </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
</script>
</head>
<body>

<div class="loading-screen" id="loadingScreen">
    <div class="spinner"></div>
</div>
    <div class="container vest-container">
        <div class="header">
            <h1>
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="url(#grad1)" stroke="url(#grad1)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 17L12 22L22 17" stroke="url(#grad1)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 12L12 17L22 12" stroke="url(#grad1)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <defs>
                        <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff006e;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#8338ec;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#3a86ff;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                </svg>
                Create Your Vest
            </h1>
            <p>Launch your startup vision in 5 simple steps</p>
        </div>

       <div class="roadmap">
    <div class="step-indicator active" data-step="1">
        <div class="step-circle">1</div>
        <div class="step-label">Vest Hook</div>
    </div>
    <div class="step-indicator" data-step="2">
        <div class="step-circle">2</div>
        <div class="step-label">Startup</div>
    </div>
    <div class="step-indicator" data-step="3">
        <div class="step-circle">3</div>
        <div class="step-label">Audit</div>
    </div>
    <div class="step-indicator" data-step="4">
        <div class="step-circle">4</div>
        <div class="step-label">Roadmap</div>
    </div>
    <div class="step-indicator" data-step="5">
        <div class="step-circle">5</div>
        <div class="step-label">Founder</div>
    </div>
    <div class="step-indicator" data-step="6">
        <div class="step-circle">6</div>
        <div class="step-label">Launch</div>
    </div>
</div>

        <div class="form-card">
           <!-- Step 1: Vest Hook & Problem-Solution -->
<div class="step-content active" data-step="1" id="vest_step1">
    <h2 class="step-title">Vest Hook & Problem-Solution</h2>
    <p class="step-subtitle">Start with a compelling hook and define the problem you're solving</p>

    <div class="form-group">
        <label>Vest Hook <span class="char-limit">(Max 15 words)</span> <span class="required">*</span></label>
        <input type="text" id="vestHook" placeholder="e.g., AI-powered recruiting platform reducing hiring time by 70%" required maxlength="150">
        <small style="color: #666; display: block; margin-top: 8px;" id="hookWordCount">0/15 words</small>
    </div>

    <div class="form-group">
        <label>Vest Description <span class="required">*</span></label>
        <textarea id="vestDescription" placeholder="Provide a detailed description of your vest..." required></textarea>
    </div>

    <div class="problem-solution-grid">
        <div class="square-box">
            <label>Current Problem</label>
            <textarea id="currentProblem" placeholder="What problem exists in the market?"></textarea>
        </div>

        <div class="square-box">
            <label>Your Solution</label>
            <textarea id="yourSolution" placeholder="How does your startup solve this?"></textarea>
        </div>
    </div>

    <div class="square-box" style="margin-bottom: 30px;">
        <label>Why You're Best For This</label>
        <textarea id="whyBest" placeholder="What makes you uniquely qualified to solve this problem?"></textarea>
    </div>

    <div class="equity-fund-row">
        <div class="form-group">
            <label>Equity Willing to Give (%) <span class="required">*</span></label>
            <input type="number" id="equityWilling" placeholder="e.g., 10" min="0" max="100" required>
        </div>

        <div class="form-group">
            <label>Fund Ask ($) <span class="required">*</span></label>
            <input type="number" id="fundAsk" placeholder="e.g., 500000" required>
        </div>
    </div>

    <div class="buttons">
        <button class="btn-draft" onclick="saveAsDraft()">Save as Draft</button>
        <button class="btn-next" onclick="nextStep()">Next Step</button>
    </div>
</div>

           <!-- Step 2: Startup Details -->
<div class="step-content" data-step="2" id="vest_step2">
    <h2 class="step-title">Startup Details</h2>
    <p class="step-subtitle">Tell us about your startup's current state</p>

    <div class="form-group">
        <label>Startup Name <span class="required">*</span></label>
        <input type="text" id="startupName" placeholder="Enter your startup name" required>
    </div>

    <div class="form-group">
        <label>Startup Description <span class="required">*</span></label>
        <textarea id="startupDescription" placeholder="Describe what your startup does..." required></textarea>
    </div>

    <div class="form-group">
        <label>Category <span class="required">*</span></label>
        <select id="category" required>
            <option value="">Select category</option>
            <option value="tech">Technology</option>
            <option value="fintech">Fintech</option>
            <option value="healthcare">Healthcare</option>
            <option value="ecommerce">E-commerce</option>
            <option value="saas">SaaS</option>
            <option value="edtech">EdTech</option>
            <option value="agritech">AgriTech</option>
            <option value="other">Other</option>
        </select>
    </div>

    <div class="form-group">
        <label>Startup Stage <span class="required">*</span></label>
        <select id="startupStage" required>
            <option value="">Select stage</option>
            <option value="idea">Idea</option>
            <option value="mvp">MVP</option>
            <option value="pre-seed">Pre-Seed</option>
            <option value="seed">Seed</option>
            <option value="series-a">Series A</option>
            <option value="series-b">Series B+</option>
        </select>
    </div>

    <div class="equity-fund-row">
        <div class="form-group">
            <label>Current Revenue ($)</label>
            <input type="number" id="currentRevenue" placeholder="e.g., 50000">
        </div>

        <div class="form-group">
            <label>Valuation ($)</label>
            <input type="number" id="valuation" placeholder="e.g., 1000000">
        </div>
    </div>

    <div class="form-group">
        <label>Pitch Deck (PDF)</label>
        <div class="file-upload" onclick="document.getElementById('pitchDeck').click()">
            <svg class="file-upload-icon" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <p style="color: #888;">Click to upload pitch deck</p>
            <small style="color: #666;">PDF format only</small>
            <input type="file" id="pitchDeck" accept=".pdf">
        </div>
        <div id="pitchDeckName" class="file-name"></div>
    </div>

    <div class="buttons">
        <button class="btn-back" onclick="previousStep()">Back</button>
        <button class="btn-draft" onclick="saveAsDraft()">Save as Draft</button>
        <button class="btn-next" onclick="nextStep()">Next Step</button>
    </div>
</div>

           <!-- Step 3: Audit -->
<div class="step-content" data-step="3" id="vest_step3">
    <h2 class="step-title">Startup Audit</h2>
    <p class="step-subtitle">Let's validate your startup's potential</p>

    <div class="form-group">
        <label>Can You Scale? <span class="required">*</span></label>
        <div class="radio-group">
            <div class="radio-item">
                <input type="radio" id="scaleYes" name="canScale" value="yes" required>
                <label for="scaleYes">Yes</label>
            </div>
            <div class="radio-item">
                <input type="radio" id="scaleNo" name="canScale" value="no">
                <label for="scaleNo">No</label>
            </div>
            <div class="radio-item">
                <input type="radio" id="scaleMaybe" name="canScale" value="maybe">
                <label for="scaleMaybe">Maybe</label>
            </div>
        </div>
        <textarea id="scaleExplanation" placeholder="Explain your scalability..." style="margin-top: 15px;"></textarea>
    </div>

    <div class="form-group">
        <label>Market Share / Target Market</label>
        <textarea id="marketShare" placeholder="What's your target market size and current/projected share?"></textarea>
    </div>

    <div class="form-group">
        <label>Competitors</label>
        <textarea id="competitors" placeholder="Who are your main competitors? What similar products exist?"></textarea>
    </div>

    <div class="form-group">
        <label>Why Your Idea is Better</label>
        <textarea id="whyBetter" placeholder="What's your competitive advantage?"></textarea>
    </div>

    <div class="form-group">
        <label>Monetization Idea <span class="required">*</span></label>
        <textarea id="monetizationIdea" placeholder="How will you make money? Explain your revenue model..." required></textarea>
    </div>

    <div class="buttons">
        <button class="btn-back" onclick="previousStep()">Back</button>
        <button class="btn-draft" onclick="saveAsDraft()">Save as Draft</button>
        <button class="btn-next" onclick="nextStep()">Next Step</button>
    </div>
</div>

            <!-- Step 4: Roadmap -->
<div class="step-content" data-step="4" id="vest_step4">
    <h2 class="step-title">Your Roadmap</h2>
    <p class="step-subtitle">Share your vision and strategy</p>

    <div class="form-group">
        <label>What Will You Do If You Get Funding? <span class="required">*</span></label>
        <textarea id="fundingPlans" placeholder="Describe how you'll use the investment..." required></textarea>
    </div>

    <div class="form-group">
        <label>Main Goal for This Year <span class="required">*</span></label>
        <textarea id="yearGoal" placeholder="What's your primary objective for this year?" required></textarea>
    </div>

    <div class="form-group">
        <label>Where Do You See Your Startup in 3 Years? <span class="required">*</span></label>
        <textarea id="threeYearVision" placeholder="Paint a picture of your future success..." required></textarea>
    </div>

    <div class="form-group">
        <label>Fund Utilization Strategy <span class="required">*</span></label>
        <textarea id="fundStrategy" placeholder="Break down how you'll allocate the funds..." required></textarea>
    </div>

    <div class="buttons">
        <button class="btn-back" onclick="previousStep()">Back</button>
        <button class="btn-draft" onclick="saveAsDraft()">Save as Draft</button>
        <button class="btn-next" onclick="nextStep()">Next Step</button>
    </div>
</div>

<!-- Step 5: Founder Presence -->
<div class="step-content" data-step="5" id="vest_step5">
    <h2 class="step-title">Founder Presence</h2>
    <p class="step-subtitle">Introduce yourself and your team</p>

    <div class="form-group">
        <label>Founder Name <span class="required">*</span></label>
        <input type="text" id="founderName" placeholder="Your full name" required>
    </div>

    <div class="form-group">
        <label>Do You Have Co-Founders?</label>
        <div class="radio-group">
            <div class="radio-item">
                <input type="radio" id="cofounderYes" name="hasCofounder" value="yes" onchange="toggleCofounderInputs(true)">
                <label for="cofounderYes">Yes</label>
            </div>
            <div class="radio-item">
                <input type="radio" id="cofounderNo" name="hasCofounder" value="no" onchange="toggleCofounderInputs(false)" checked>
                <label for="cofounderNo">No</label>
            </div>
        </div>
    </div>

    <div class="cofounder-inputs" id="cofounderInputs">
        <div class="form-group">
            <label>How Many Co-Founders?</label>
            <input type="number" id="cofounderCount" min="1" max="10" placeholder="e.g., 2" onchange="generateCofounderFields()">
        </div>
        <div id="cofounderFields"></div>
    </div>

    <div class="form-group">
        <label>Demo Video (Optional)</label>
        <div class="file-upload" onclick="document.getElementById('demoVideo').click()">
            <svg class="file-upload-icon" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2">
                <polygon points="23 7 16 12 23 17 23 7"></polygon>
                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
            </svg>
            <p style="color: #888;">Upload a demo video</p>
            <small style="color: #666;">MP4, MOV, or AVI</small>
            <input type="file" id="demoVideo" accept="video/*">
        </div>
        <div id="demoVideoName" class="file-name"></div>
    </div>

    <div class="form-group">
        <label>Your Past Work & Experience</label>
        <textarea id="founderWork" placeholder="Describe your relevant experience and achievements..."></textarea>
    </div>

    <!-- âœ… MISSING BUTTONS - ADD THIS -->
    <div class="buttons">
        <button class="btn-back" onclick="previousStep()">Back</button>
        <button class="btn-draft" onclick="saveAsDraft()">Save as Draft</button>
        <button class="btn-next" onclick="showCompletionPopup()">âœ… Complete Vest</button>
    </div>
</div>
<!-- ========== STEP 5 ENDS HERE ========== -->
</div>
<!-- ========== STEP 5 ENDS HERE ========== -->

<!-- Success Completion Popup -->
<div class="completion-popup" id="completionPopup">
    <div class="completion-popup-content">
        <!-- Close Button -->
        <button class="popup-close" onclick="closeCompletionPopup()">Ã—</button>
        
        <!-- Success Animation -->
        <div style="text-align: center; padding: 2rem;">
            <div style="font-size: 5rem; margin-bottom: 1.5rem; animation: bounceIn 1s ease;">ðŸŽ‰</div>
            
            <h2 style="font-size: 2rem; font-weight: 800; color: #fff; margin-bottom: 1rem;">
                Successfully Completed!
            </h2>
            
            <p style="color: #888; font-size: 1.1rem; margin-bottom: 2rem;">
                Your vest is ready to be launched to investors
            </p>
            
            <!-- Completion Checklist -->
            <div style="background: #000; border: 1px solid #222; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; text-align: left;">
                <h3 style="color: #fff; margin-bottom: 1rem; text-align: center; font-size: 1.1rem;">âœ… All Sections Complete</h3>
                
                <div style="display: flex; align-items: center; gap: 1rem; padding: 0.6rem; margin-bottom: 0.5rem;">
                    <div style="width: 24px; height: 24px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <span style="color: #fff; font-weight: bold; font-size: 0.8rem;">âœ“</span>
                    </div>
                    <span style="color: #aaa; font-size: 0.95rem;">Vest Hook & Problem-Solution</span>
                </div>
                
                <div style="display: flex; align-items: center; gap: 1rem; padding: 0.6rem; margin-bottom: 0.5rem;">
                    <div style="width: 24px; height: 24px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <span style="color: #fff; font-weight: bold; font-size: 0.8rem;">âœ“</span>
                    </div>
                    <span style="color: #aaa; font-size: 0.95rem;">Startup Details</span>
                </div>
                
                <div style="display: flex; align-items: center; gap: 1rem; padding: 0.6rem; margin-bottom: 0.5rem;">
                    <div style="width: 24px; height: 24px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <span style="color: #fff; font-weight: bold; font-size: 0.8rem;">âœ“</span>
                    </div>
                    <span style="color: #aaa; font-size: 0.95rem;">Startup Audit</span>
                </div>
                
                <div style="display: flex; align-items: center; gap: 1rem; padding: 0.6rem; margin-bottom: 0.5rem;">
                    <div style="width: 24px; height: 24px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <span style="color: #fff; font-weight: bold; font-size: 0.8rem;">âœ“</span>
                    </div>
                    <span style="color: #aaa; font-size: 0.95rem;">Roadmap & Vision</span>
                </div>
                
                <div style="display: flex; align-items: center; gap: 1rem; padding: 0.6rem;">
                    <div style="width: 24px; height: 24px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <span style="color: #fff; font-weight: bold; font-size: 0.8rem;">âœ“</span>
                    </div>
                    <span style="color: #aaa; font-size: 0.95rem;">Founder Presence</span>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button class="popup-btn-draft" onclick="saveAsDraft()">
                    ðŸ’¾ Save as Draft
                </button>
                <button class="popup-btn-launch" onclick="launchVest()">
                    ðŸš€ Launch Vest
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Step 6: Launch -->
<div class="step-content" data-step="6" id="vest_step6">
    <div style="text-align: center; padding: 3rem 2rem;">
        <!-- Success Icon -->
        <div style="font-size: 6rem; margin-bottom: 2rem; animation: bounce 2s infinite;">ðŸŽ‰</div>
        
        <!-- Success Message -->
        <h2 class="step-title" style="font-size: 2.5rem; margin-bottom: 1rem;">
            Ready to Launch!
        </h2>
        
        <p class="step-subtitle" style="font-size: 1.2rem; margin-bottom: 3rem;">
            Your vest is complete and ready to be launched to investors
        </p>
        
        <!-- Completion Checklist -->
        <div style="background: #0a0a0a; border: 1px solid #222; border-radius: 12px; padding: 2rem; margin-bottom: 3rem; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto;">
            <h3 style="color: #fff; margin-bottom: 1.5rem; text-align: center;">âœ… Completed Sections</h3>
            
            <div style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; margin-bottom: 0.5rem;">
                <div style="width: 30px; height: 30px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <span style="color: #fff; font-weight: bold;">âœ“</span>
                </div>
                <span style="color: #aaa;">Vest Hook & Problem-Solution</span>
            </div>
            
            <div style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; margin-bottom: 0.5rem;">
                <div style="width: 30px; height: 30px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <span style="color: #fff; font-weight: bold;">âœ“</span>
                </div>
                <span style="color: #aaa;">Startup Details</span>
            </div>
            
            <div style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; margin-bottom: 0.5rem;">
                <div style="width: 30px; height: 30px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <span style="color: #fff; font-weight: bold;">âœ“</span>
                </div>
                <span style="color: #aaa;">Startup Audit</span>
            </div>
            
            <div style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; margin-bottom: 0.5rem;">
                <div style="width: 30px; height: 30px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <span style="color: #fff; font-weight: bold;">âœ“</span>
                </div>
                <span style="color: #aaa;">Roadmap & Vision</span>
            </div>
            
            <div style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem;">
                <div style="width: 30px; height: 30px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <span style="color: #fff; font-weight: bold;">âœ“</span>
                </div>
                <span style="color: #aaa;">Founder Presence</span>
            </div>
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="buttons">
        <button class="btn-back" onclick="previousStep()">Back</button>
        <button class="btn-draft" onclick="saveAsDraft()">Save as Draft</button>
        <button class="btn-launch" onclick="launchVest()">ðŸš€ Launch Vest</button>
    </div>
</div>

<!-- Add bounce animation -->
<style>
    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-20px); }
    }
</style>

<!-- Celebration -->
<div class="celebration" id="celebration">
    <svg style="width: 120px; height: 120px; margin-bottom: 30px;" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
        <line x1="9" y1="9" x2="9.01" y2="9"></line>
        <line x1="15" y1="9" x2="15.01" y2="9"></line>
    </svg>
    <h2>Vest Successfully Launched!</h2>
    <p>Your vest is now live and visible to investors</p>
    <a href="#founder_dashboard" class="dashboard-btn">Go to Dashboard</a>
</div>

   <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, set, push, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
// Locate your existing import and add 'update' to the list
import { 
    update, 
    onValue 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    const firebaseConfig = {
        apiKey: "AIzaSyD6PdrKp2XLfRqjC587lMpdKTaWD4MBens",
        authDomain: "scalevest-163a0.firebaseapp.com",
        databaseURL: "https://scalevest-163a0-default-rtdb.firebaseio.com",
        projectId: "scalevest-163a0",
        storageBucket: "scalevest-163a0.firebasestorage.app",
        messagingSenderId: "938358950124",
        appId: "1:938358950124:web:043506aeaacea2a96bfdc9",
        measurementId: "G-QD3TWBZHR0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const storage = getStorage(app);
    const auth = getAuth(app);

    let currentUser = null;
const STORAGE_KEY = 'vestFormData';
// Helper function to create reusable navbar
function createNavBar() {
    const founderData = cachedFounderData || {};
    return `
        <nav class="top-nav">
            <div class="logo" onclick="window.location.hash='founder_dashboard'" style="cursor: pointer;">ScaleVest</div>
            <div class="nav-links">
                <a href="#founder_dashboard" class="nav-link">Dashboard</a>
                <a href="#" class="nav-link">My Startup</a>
                <a href="#" class="nav-link">Analytics</a>
                <div class="dropdown">
                    <span class="nav-link" onclick="toggleDropdown('scaleDropdown')">Scale and Elevate â–¾</span>
                    <div class="dropdown-content" id="scaleDropdown">
                        <a href="#" class="dropdown-item">Founder Emergence</a>
                        <a href="#" class="dropdown-item">Referrals</a>
                        <a href="#" class="dropdown-item">Contacts</a>
                        <a href="#" class="dropdown-item">My Trials</a>
                    </div>
                </div>
            </div>
            <div class="top-nav-right">
                <div class="icon-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                </div>
                <div class="icon-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                </div>
                <div class="profile-dropdown">
<div class="icon-btn" onclick="toggleDashProfileDropdown()">
    ${founderData?.photoURL 
        ? `<img src="${founderData.photoURL}" alt="Profile" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">` 
        : `<div style="font-size:1.2rem;font-weight:600;">${founderData.founderImage || 'U'}</div>`}
</div>
                    </div>
                    <div class="profile-dropdown-content" id="dashProfileDropdown">
                        <div class="profile-info">
                            <div class="profile-username">${founderData.founderUsername || 'Username'}</div>
                            <div class="profile-userid">${founderData.userId || 'USER_ID'}</div>
                        </div>
                        <button class="switch-btn">Switch to Browse</button>
                        <div class="profile-section">
                            <a href="#" class="profile-link">Refer a Friend</a>
                            <a href="#edit_founderprofile" class="profile-link">Profile</a>
                            <a href="#" class="profile-link" onclick="auth.signOut();return false;">Log Out</a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    `;
}

// Toggle dropdown function
window.toggleDropdown = function(id) {
    event.stopPropagation();
    const dropdown = document.getElementById(id);
    
    // Close all other dropdowns
    document.querySelectorAll('.dropdown-content').forEach(dd => {
        if (dd.id !== id) dd.classList.remove('show');
    });
    
    // Toggle this dropdown
    dropdown.classList.toggle('show');
};

// Toggle profile dropdown
window.toggleDashProfileDropdown = function() {
    event.stopPropagation();
    const dropdown = document.getElementById('dashProfileDropdown');
    if (dropdown) {
        dropdown.classList.toggle('show');
    }
};

// Close dropdowns when clicking outside
document.addEventListener('click', (e) => {
    if (!e.target.closest('.dropdown') && !e.target.closest('.profile-dropdown')) {
        document.querySelectorAll('.dropdown-content, .profile-dropdown-content').forEach(dd => {
            dd.classList.remove('show');
        });
    }
});
// Save form data to localStorage
function saveToLocalStorage() {
    const formData = {
        vestTitle: document.getElementById('vestTitle')?.value || '',
        vestDescription: document.getElementById('vestDescription')?.value || '',
        keywords: keywords,
        startupStage: document.getElementById('startupStage')?.value || '',
        category: document.getElementById('category')?.value || '',
        startupName: document.getElementById('startupName')?.value || '',
        startupDescription: document.getElementById('startupDescription')?.value || '',
        fundingAmount: document.getElementById('fundingAmount')?.value || '',
        founderName: document.getElementById('founderName')?.value || '',
        currentStep: currentStep
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(formData));
}

// Load form data from localStorage
function loadFromLocalStorage() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (!saved) return;
    
    const data = JSON.parse(saved);
    
    if (data.vestTitle) document.getElementById('vestTitle').value = data.vestTitle;
    if (data.vestDescription) document.getElementById('vestDescription').value = data.vestDescription;
    if (data.keywords) {
        keywords = data.keywords;
        updateTagsDisplay();
    }
    if (data.startupStage) document.getElementById('startupStage').value = data.startupStage;
    if (data.category) document.getElementById('category').value = data.category;
    if (data.startupName) document.getElementById('startupName').value = data.startupName;
    if (data.startupDescription) document.getElementById('startupDescription').value = data.startupDescription;
    if (data.fundingAmount) document.getElementById('fundingAmount').value = data.fundingAmount;
    if (data.founderName) document.getElementById('founderName').value = data.founderName;
    if (data.currentStep) {
        currentStep = data.currentStep;
        updateStepDisplay();
    }
}
    let isInitialLoad = true;
    let currentStep = 1;
    let keywords = [];
    let uploadedFiles = {
        startupLogo: null,
        pitchDeck: null,
        transactionProof: null
    };
 let isNewUser = false; 
let cachedFounderData = null;
let cachedStartupData = null;



window.nextStep = function() {
    // Validate current step before moving
    if (!validateStep(currentStep)) return;

    if (currentStep < 6) {
        currentStep++;
        saveToLocalStorage();
        window.location.hash = `vest_step${currentStep}`;
        updateStepDisplay();
        window.scrollTo(0, 0);
    }
};
window.previousStep = function() {
    if (currentStep > 1) {
        currentStep--;
        saveToLocalStorage();
        window.location.hash = `vest_step${currentStep}`;
        updateStepDisplay();
        window.scrollTo(0, 0);
    }
};
// ======================================================
// GLOBAL ACTIONS 
// ======================================================

// 1. CO-FOUNDER TOGGLE
window.toggleCofounderInputs = function(show) {
    const inputs = document.getElementById('cofounderInputs');
    if (show) {
        inputs.classList.add('show');
    } else {
        inputs.classList.remove('show');
    }
};

// 2. GENERATE FIELDS
window.generateCofounderFields = function() {
    const countInput = document.getElementById('cofounderCount');
    const container = document.getElementById('cofounderFields');
    if (!countInput || !container) return;

    const count = parseInt(countInput.value) || 0;
    container.innerHTML = '';
    
    for (let i = 1; i <= count; i++) {
        const div = document.createElement('div');
        div.className = 'cofounder-item';
        div.innerHTML = `
            <h4 style="margin-bottom: 15px; color: #fff;">Co-Founder ${i}</h4>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="cofounder${i}Name" placeholder="Full name" style="background:#050505; border:1px solid #333; color:#fff; width:100%; padding:10px; border-radius:8px;">
            </div>
            <div class="form-group">
                <label>Past Work</label>
                <textarea id="cofounder${i}Work" placeholder="Experience..." style="background:#050505; border:1px solid #333; color:#fff; width:100%; padding:10px; border-radius:8px;"></textarea>
            </div>
        `;
        container.appendChild(div);
    }
};

// 3. SAVE AS DRAFT (Global)
window.saveAsDraft = async function() {
    const btn = event.target.closest('button'); // Get button safely
    const originalText = btn.innerHTML;
    btn.innerHTML = 'â³ Saving...';
    btn.disabled = true;

    try {
        // Ensure processAllFiles exists or skip
        if (typeof processAllFiles === 'function') await processAllFiles();
        
        // Use window.collectVestData to be safe
        const vestData = window.collectVestData(); 
        if (!vestData) throw new Error("Could not collect data");
        
        vestData.status = 'draft';
        vestData.lastUpdated = new Date().toISOString();

        // Save to Firebase
        await set(ref(db, `Vests/${currentUser.uid}/Vest1`), vestData);
        
        // Update profile stats
        await update(ref(db, `founderProfile/${currentUser.uid}`), { draftVestsCount: 1 });
        
        btn.innerHTML = 'âœ… Saved!';
        setTimeout(() => { 
            btn.innerHTML = originalText; 
            btn.disabled = false;
            // Optional: window.location.hash = 'founder_dashboard'; 
        }, 1500);
        
    } catch (error) {
        console.error('Save error:', error);
        btn.innerHTML = 'âŒ Error';
        btn.disabled = false;
        alert('Save failed: ' + error.message);
    }
};
// ============================================
// COMPLETION POPUP FUNCTIONS
// ============================================

window.showCompletionPopup = function() {
    const popup = document.getElementById('completionPopup');
    if (popup) {
        popup.classList.add('show');
        
        // Play a subtle sound effect (optional)
        // You can add audio here if you want
    }
};

window.closeCompletionPopup = function() {
    const popup = document.getElementById('completionPopup');
    if (popup) {
        popup.classList.remove('show');
    }
};

// Close popup when clicking outside
document.addEventListener('click', (e) => {
    const popup = document.getElementById('completionPopup');
    if (popup && e.target === popup) {
        closeCompletionPopup();
    }
});

// Close popup on ESC key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeCompletionPopup();
    }
});
window.launchVest = async function() {
    console.log('ðŸš€ Launch initiated...');
    
    // Close completion popup if open
    closeCompletionPopup();
    
    const btn = event?.target?.closest('button');
    if (!btn) {
        alert('âŒ Button not found');
        return;
    }
    
    const originalText = btn.innerHTML;
    btn.innerHTML = 'â³ Launching...';
    btn.disabled = true;

    try {
        // Step 1: Process files
        console.log('ðŸ“ Processing files...');
        await processAllFiles();
        
        // Step 2: Collect vest data
        console.log('ðŸ“Š Collecting vest data...');
        const vestData = window.collectVestData();
        if (!vestData) throw new Error("Data collection failed");
        
        console.log('Vest data collected:', vestData);
        
        vestData.status = 'live';
        vestData.launchedAt = new Date().toISOString();

        // Step 3: Save to Firebase
        console.log('ðŸ’¾ Saving to Firebase...');
        await set(ref(db, `Vests/${currentUser.uid}/Vest1`), vestData);
        console.log('âœ… Vest saved to Firebase');
        
        // Step 4: Update founder profile stats
        console.log('ðŸ‘¤ Updating founder profile...');
        await update(ref(db, `founderProfile/${currentUser.uid}`), { 
            activeVestsCount: 1,
            lastLaunchedVest: new Date().toISOString()
        });
        console.log('âœ… Founder profile updated');
        
        // Step 5: Update Startup Profile (only if startup name exists)
        if (vestData.StartupDetails?.startupName) {
            console.log('ðŸ¢ Saving startup profile...');
            await saveStartupProfile(vestData);
            console.log('âœ… Startup profile saved');
        }
        
        // Step 6: Show celebration
        console.log('ðŸŽ‰ Showing celebration...');
        closeCompletionPopup();
        document.querySelector('.vest-container').style.display = 'none';
        
        const celebration = document.getElementById('celebration');
        celebration.classList.add('active');
        celebration.style.display = 'block';
        
        window.scrollTo(0, 0);
        console.log('âœ… LAUNCH SUCCESSFUL!');
        
    } catch (error) {
        console.error('âŒ Launch error:', error);
        console.error('Error stack:', error.stack);
        
        btn.innerHTML = 'âŒ Launch Failed';
        btn.disabled = false;
        
        alert(`âŒ Launch failed!\n\nError: ${error.message}\n\nCheck console (F12) for details.`);
        
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }, 2000);
    }
};
// Simple validation helper
function validateStep(step) {
    const activeStep = document.querySelector(`.step-content[data-step="${step}"]`);
    if (!activeStep) return true;

    const requiredInputs = activeStep.querySelectorAll('[required]');
    let isValid = true;

    requiredInputs.forEach(input => {
        if (!input.value.trim()) {
            input.style.borderColor = '#ff006e';
            isValid = false;
        } else {
            input.style.borderColor = '#222';
        }
    });

    if (!isValid) {
        alert('Please fill in all required fields marked with *');
    }
    return isValid;
}
// -----------------------------------------------------------

   onAuthStateChanged(auth, async (user) => {
    if (user) {
        currentUser = user;
        isInitialLoad = false;
        
        document.getElementById('loadingScreen').classList.remove('hidden');
        
        try {
            const [vestsSnapshot, founderSnapshot, startupSnapshot] = await Promise.all([
                get(ref(db, `Vests/${user.uid}`)),
                get(ref(db, `founderProfile/${user.uid}`)),
                get(ref(db, `startupProfile/${user.uid}`))
            ]);
            
            // Auto-create founder profile if not exists
            if (!founderSnapshot.exists()) {
                const email = user.email || 'user@scalevest.com';
                const username = email.split('@')[0];
                const firstLetter = email.charAt(0).toUpperCase();
                
                cachedFounderData = {
                    founderUsername: username,
                    founderImage: firstLetter,
                    email: email,
                    title: '',
                    about: '',
                    createdAt: new Date().toISOString()
                };
                
                await update(ref(db, `founderProfile/${user.uid}`), cachedFounderData);
                
                // Hide loading screen and show User ID setup
                document.getElementById('loadingScreen').classList.add('hidden');
                showUserIdSetupModal();
                return; // Stop here until userId is set
            } else {
                cachedFounderData = founderSnapshot.val();
                
                // If profile exists but no userId, show popup
                if (!cachedFounderData.userId) {
                    document.getElementById('loadingScreen').classList.add('hidden');
                    showUserIdSetupModal();
                    return;
                }
            }
            
            // Cache startup data
            if (startupSnapshot.exists()) {
                cachedStartupData = startupSnapshot.val();
            } else {
                cachedStartupData = null;
            }
            
            isNewUser = !vestsSnapshot.exists();
            
            document.getElementById('loadingScreen').classList.add('hidden');
            
            const hash = window.location.hash.slice(1);
            
            if (!hash) {
                if (isNewUser) {
                    window.location.hash = 'vest_step1';
                } else {
                    window.location.hash = 'founder_dashboard';
                }
            } else {
                handleHashChange();
            }
            
        } catch (error) {
            console.error('Data loading error:', error);
            document.getElementById('loadingScreen').classList.add('hidden');
        }
    } else {
        if (!isInitialLoad) {
            window.location.href = 'login2.html';
        } else {
            setTimeout(() => {
                if (!auth.currentUser) window.location.href = 'login2.html';
            }, 2000);
            isInitialLoad = false;
        }
    }
});

    // ========================================
    // SECTION 2: PLACE HASH CHANGE HANDLER HERE
    // ========================================
    
    // Handle hash navigation
    window.addEventListener('hashchange', handleHashChange);

    function handleHashChange() {
    if (!currentUser || !cachedFounderData) {
        console.log("Waiting for data...");
        return;
    }
    
    const hash = window.location.hash.slice(1);
    console.log("Hash changed to:", hash);
    
    // Hide everything first
    document.querySelector('.vest-container').style.display = 'none';
    const dashContainer = document.getElementById('dashboardContainer');
    if (dashContainer) dashContainer.style.display = 'none';
    
    // Then show the right thing
    if (hash === 'founder_dashboard') {
        showDashboard();
    } else if (hash === 'edit_founderprofile') {
        showEditProfile();
} else if (hash === 'edit_startup') {
    showEditStartup();
    } else if (hash.startsWith('vest_step')) {
        const stepNum = parseInt(hash.replace('vest_step', ''));
        if (stepNum >= 1 && stepNum <= 5) {
            currentStep = stepNum;
            updateStepDisplay();
            showVestForm();
        }
    } else if (!hash) {
        if (isNewUser) {
            window.location.hash = 'vest_step1';
        } else {
            window.location.hash = 'founder_dashboard';
        }
    }
}

    function showVestForm() {
        document.title = "Create Your Vest | ScaleVest"; 
        document.querySelector('.vest-container').style.display = 'block';
        const dashContainer = document.getElementById('dashboardContainer');
        if (dashContainer) {
            dashContainer.style.display = 'none';
        }
    }

    function showDashboard() {
        document.title = "Founder Dashboard | ScaleVest";
        document.querySelector('.vest-container').style.display = 'none';
        
        let container = document.getElementById('dashboardContainer');
        if (!container) {
            container = document.createElement('div');
            container.id = 'dashboardContainer';
            document.body.appendChild(container);
        }
        
        container.style.display = 'block';
        createDashboard();
    }
// Word count for vest hook
document.getElementById('vestHook')?.addEventListener('input', function() {
    const words = this.value.trim().split(/\s+/).filter(w => w.length > 0);
    const count = words.length;
    const counter = document.getElementById('hookWordCount');
    counter.textContent = `${count}/15 words`;
    counter.style.color = count > 15 ? '#ff4444' : '#666';
});

// Co-founder toggle
function toggleCofounderInputs(show) {
    const inputs = document.getElementById('cofounderInputs');
    if (show) {
        inputs.classList.add('show');
    } else {
        inputs.classList.remove('show');
    }
}

// Generate co-founder fields dynamically
function generateCofounderFields() {
    const count = parseInt(document.getElementById('cofounderCount').value) || 0;
    const container = document.getElementById('cofounderFields');
    container.innerHTML = '';
    
    for (let i = 1; i <= count; i++) {
        const cofounderDiv = document.createElement('div');
        cofounderDiv.className = 'cofounder-item';
        cofounderDiv.innerHTML = `
            <h4 style="margin-bottom: 15px; color: #fff;">Co-Founder ${i}</h4>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="cofounder${i}Name" placeholder="Full name">
            </div>
            <div class="form-group">
                <label>Past Work</label>
                <textarea id="cofounder${i}Work" placeholder="Experience and background..."></textarea>
            </div>
        `;
        container.appendChild(cofounderDiv);
    }
}

// File name display
document.getElementById('demoVideo')?.addEventListener('change', function(e) {
    if (e.target.files[0]) {
        document.getElementById('demoVideoName').textContent = 'âœ“ ' + e.target.files[0].name;
    }
});
    // ========================================
    // SECTION 3: ADD NEW STARTUP PROFILE SAVE FUNCTION HERE
    // ========================================
    
async function saveStartupProfile(vestData) {
    if (!currentUser) {
        console.error('No current user');
        return;
    }
    
    try {
        const startupProfileRef = ref(db, `startupProfile/${currentUser.uid}`);
        
        // Check if startupProfile already exists
        const existingProfile = await get(startupProfileRef);
        
        const startupData = {
            startupName: vestData.StartupDetails?.startupName || '',
            description: vestData.StartupDetails?.startupDescription || '',
            stage: vestData.StartupDetails?.startupStage || '',
            category: vestData.StartupDetails?.category || '',
            revenue: vestData.StartupDetails?.currentRevenue || 0,
            valuation: vestData.StartupDetails?.valuation || 0,
            pitchDeckUrl: vestData.StartupDetails?.pitchDeckUrl || '',
            founderId: currentUser.uid,
            updatedAt: new Date().toISOString()
        };
        
        // Only generate startupId if it doesn't exist (PERMANENT)
        if (!existingProfile.exists() || !existingProfile.val()?.startupId) {
            startupData.startupId = generateStartupId(startupData.startupName);
            startupData.createdAt = new Date().toISOString();
        }
        
        await update(startupProfileRef, startupData);
        
        console.log('âœ… Startup profile saved:', startupData);
        return startupData;
        
    } catch (error) {
        console.error('Error saving startup profile:', error);
        throw error; // Re-throw so launchVest can catch it
    }
}    // ========================================
    // SECTION 4: UPDATE createDashboard FUNCTION
    // ========================================
    
  async function createDashboard() {
    if (!currentUser) return;
    
    // Use cached data if available, otherwise fetch
    let founderData = cachedFounderData;
    let startupData = cachedStartupData;
    let vestsData = {};
    
    // If no cached data, fetch it
    if (!founderData) {
        const founderProfileRef = ref(db, `founderProfile/${currentUser.uid}`);
        const founderSnap = await get(founderProfileRef);
        founderData = founderSnap.val();
        cachedFounderData = founderData;
    }
    
    // Handle old profile structure (firstName/lastName) vs new (founderUsername)
    if (founderData && !founderData.founderUsername) {
        founderData.founderUsername = founderData.firstName 
            ? `${founderData.firstName} ${founderData.lastName || ''}`.trim()
            : (founderData.email || 'User').split('@')[0];
        
        founderData.founderImage = founderData.firstName 
            ? founderData.firstName.charAt(0).toUpperCase()
            : (founderData.email || 'U').charAt(0).toUpperCase();
        
        console.log('âœ… Converted old profile to new format:', founderData);
    }
    
    // FIX: Always fetch fresh startup data
    if (!startupData) {
        const startupProfileRef = ref(db, `startupProfile/${currentUser.uid}`);
        const startupSnap = await get(startupProfileRef);
        if (startupSnap.exists()) {
            startupData = startupSnap.val();
            cachedStartupData = startupData;
            console.log('âœ… Fetched startup data:', startupData);
        } else {
            console.log('âš ï¸ No startup profile found in database');
        }
    } else {
        console.log('âœ… Using cached startup data:', startupData);
    }
    
    // Always fetch fresh vests data
    const vestsRef = ref(db, `Vests/${currentUser.uid}`);
    const vestsSnap = await get(vestsRef);
    if (vestsSnap.exists()) {
        vestsData = vestsSnap.val();
    }
    
    console.log('Dashboard loaded with:', { founderData, startupData, vestsData });
    
    const draftCount = Object.values(vestsData).filter(v => v.status === 'draft').length;
    const activeCount = Object.values(vestsData).filter(v => v.status === 'live').length;
  
    
    const dashboardHTML = `
       <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
        }

        /* Top Navigation */
        .top-nav {
            background: #0a0a0a;
            padding: 1.2rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #222;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .logo {
            font-size: 2rem;
            font-weight: 700;
            color: #fff;
            cursor: pointer;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .nav-links {
            display: flex;
            gap: 2.5rem;
            align-items: center;
        }

        .nav-link {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: #fff;
            transition: width 0.3s;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .dropdown {
            position: relative;
        }

.dropdown-content {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background: #1a1a1a;
    min-width: 220px;
    border-radius: 12px;
    margin-top: 1rem;
    box-shadow: 0 10px 40px rgba(255, 255, 255, 0.1);
    border: 1px solid #333;
    overflow: hidden;
    z-index: 1000;
}


.dropdown-content.show {
    display: block !important;
    animation: fadeIn 0.3s;
}

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-item {
            padding: 1rem 1.5rem;
            color: #fff;
            text-decoration: none;
            display: block;
            transition: all 0.3s;
            cursor: pointer;
            border-left: 3px solid transparent;
        }

        .dropdown-item:hover {
            background: #222;
            border-left-color: #fff;
            padding-left: 2rem;
        }

        .top-nav-right {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            border: 1px solid #222;
        }

        .icon-btn:hover {
            background: #fff;
            border-color: #fff;
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
        }

        .icon-btn:hover svg {
            stroke: #000;
        }

        .profile-dropdown {
            position: relative;
        }

        .profile-dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: #1a1a1a;
            min-width: 300px;
            border-radius: 12px;
            margin-top: 1rem;
            box-shadow: 0 10px 40px rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            padding: 1rem;
            animation: fadeIn 0.3s;
        }

        .profile-dropdown-content.show {
            display: block;
        }

        .profile-info {
            padding: 1rem;
            border-bottom: 1px solid #333;
            margin-bottom: 1rem;
        }

        .profile-username {
            font-weight: 600;
            font-size: 1.2rem;
        }

        .profile-userid {
            color: #888;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .switch-btn {
            background: #fff;
            color: #000;
            border: none;
            padding: 0.9rem;
            width: 100%;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            margin-bottom: 1rem;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .switch-btn:hover {
            background: #ddd;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.3);
        }

        .profile-section {
            padding: 0.5rem 0;
        }
/* ===== SVG ICON FIX (GLOBAL) ===== */
svg {
    display: inline-block;
    vertical-align: middle;
    flex-shrink: 0;
}

/* Prevent stroke distortion */
svg path,
svg circle,
svg polyline,
svg rect,
svg line {
    vector-effect: non-scaling-stroke;
}

/* Banner + Card icons sizing */
.banner h3 svg,
.dash-card-title svg,
.welcome-text svg {
    width: 24px;
    height: 24px;
    stroke-width: 2;
}

/* Right-side big icons */
.banner-icon svg {
    width: 56px;
    height: 56px;
    opacity: 0.9;
}

        .profile-link {
            padding: 0.9rem 1rem;
            display: block;
            color: #fff;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
            font-weight: 500;
        }

        .profile-link:hover {
            background: #222;
            padding-left: 1.5rem;
        }

        /* Main Content */
        .container {
            padding: 3rem 3rem;
            display: flex;
            gap: 3rem;
            max-width: 1800px;
            margin: 0 auto;
        }

        .left-section {
            width: 380px;
            flex-shrink: 0;
        }

        .right-section {
            flex: 1;
max-width: 1100px;
        }

        .welcome-section {
            margin-bottom: 3rem;
        }

        .welcome-text {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, #fff 0%, #888 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .welcome-subtext {
            color: #888;
            font-size: 1.1rem;
        }

        /* Left Cards Section */
        .left-cards {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .card {
            background: #0a0a0a;
            border-radius: 16px;
            padding: 2.5rem;
            border: 1px solid #222;
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #fff 0%, #666 100%);
            transform: scaleX(0);
            transition: transform 0.4s;
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .card:hover {
            border-color: #444;
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(255, 255, 255, 0.1);
        }

        .profile-avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: #fff;
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0 auto 1.5rem;
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.2);
        }

        .card-title {
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .card-subtitle {
            text-align: center;
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        .card-btn {
            background: transparent;
            color: #fff;
            border: 2px solid #fff;
            padding: 0.9rem 1.5rem;
            width: 100%;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .card-btn:hover {
            background: #fff;
            color: #000;
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.3);
        }

        .startup-logo {
            width: 90px;
            height: 90px;
            border-radius: 16px;
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1a1a1a;
            overflow: hidden;
            border: 2px solid #333;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        }

        .startup-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .availability-indicator {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.2);
        }

        .card-description {
            text-align: center;
            color: #aaa;
            font-size: 0.85rem;
            margin-top: 1.5rem;
            line-height: 1.6;
        }

        /* Banners Section */
        .banners-section {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .banner {
            background: #0a0a0a;
            border-radius: 16px;
            padding: 3rem;
            border: 1px solid #222;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
        }

        .banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: #fff;
            transform: scaleY(0);
            transition: transform 0.4s;
        }

        .banner:hover::before {
            transform: scaleY(1);
        }

        .banner:hover {
            border-color: #444;
            transform: translateX(10px);
            box-shadow: 0 10px 40px rgba(255, 255, 255, 0.1);
        }

        .banner-content h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .banner-content p {
            color: #aaa;
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .banner-icon {
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1a1a1a;
            border-radius: 20px;
            border: 2px solid #333;
            flex-shrink: 0;
            margin-left: 2rem;
        }

        .vests-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .vests-tabs {
            display: flex;
            gap: 0.5rem;
        }

        .vest-tab {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 0.9rem;
            background: transparent;
            border: 1px solid #333;
        }

        .vest-tab.active {
            background: #fff;
            color: #000;
            border-color: #fff;
        }

        .vest-tab:hover:not(.active) {
            background: #222;
            border-color: #444;
        }

        /* Footer */
        .footer {
            background: #0a0a0a;
            border-top: 1px solid #222;
            padding: 3rem;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-logo {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .footer-logo-text {
            font-size: 2rem;
            font-weight: 700;
            color: #fff;
        }

        .footer-company {
            color: #fff;
            font-size: 0.9rem;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5),
                         0 0 20px rgba(255, 255, 255, 0.3),
                         0 0 30px rgba(255, 255, 255, 0.2);
            font-weight: 500;
        }

        .footer-links {
            display: flex;
            gap: 2rem;
        }

        .footer-link {
            color: #888;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 500;
        }

        .footer-link:hover {
            color: #fff;
        }

        .inbox-card {
            max-height: 300px;
            overflow-y: auto;
        }

        .inbox-card::-webkit-scrollbar {
            width: 6px;
        }

        .inbox-card::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 10px;
        }

        .inbox-card::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 10px;
        }

        .inbox-message {
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: #1a1a1a;
            border-radius: 8px;
            border-left: 3px solid #fff;
        }

        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
                padding: 2rem 1.5rem;
                gap: 2rem;
            }

            .left-section {
                width: 100%;
            }

            .top-nav {
                padding: 1rem 1.5rem;
                flex-wrap: wrap;
            }

            .logo {
                font-size: 1.5rem;
            }

            .nav-links {
                display: none;
            }

            .welcome-text {
                font-size: 1.8rem;
            }

            .banner {
                padding: 2rem;
                flex-direction: column;
                text-align: center;
            }

            .banner-icon {
                margin-left: 0;
                margin-top: 1.5rem;
            }

            .banner-content h3 {
                font-size: 1.4rem;
            }

            .card {
                padding: 2rem;
            }

            .footer {
                padding: 2rem 1.5rem;
            }

            .footer-content {
                flex-direction: column;
                gap: 2rem;
                text-align: center;
            }

            .vests-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .vests-tabs {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .top-nav {
                padding: 0.75rem 1rem;
            }

            .container {
                padding: 1.5rem 1rem;
            }

            .welcome-text {
                font-size: 1.5rem;
            }

            .banner {
                padding: 1.5rem;
            }
@media (max-width: 768px) {
    .top-nav {
        padding: 1rem;
        flex-wrap: nowrap;
        overflow-x: auto;
    }
    
    .logo {
        font-size: 1.5rem;
    }
    
    .nav-links {
        display: none;
    }
    
    .top-nav-right {
        gap: 0.75rem;
    }
    
    .icon-btn {
        width: 36px;
        height: 36px;
    }
    
    .container {
        padding: 1.5rem 1rem;
    }
}
            .banner-content h3 {
                font-size: 1.2rem;
            }

            .banner-content p {
                font-size: 0.95rem;
            }

            .card {
                padding: 1.5rem;
            }

            .profile-avatar, .startup-logo, .availability-indicator {
                width: 70px;
                height: 70px;
            }

            .card-title {
                font-size: 1.1rem;
            }

            .vest-tab {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
            }

            .footer {
                padding: 1.5rem 1rem;
            }
        }
    </style>


       <!-- Top Navigation -->
<nav class="top-nav">
    <div class="logo">ScaleVest</div>

    <div class="nav-links">
        <a href="#founder_dashboard" class="nav-link">Dashboard</a>
        <a href="#" class="nav-link">My Startup</a>
        <a href="#" class="nav-link">Analytics</a>

<div class="dropdown">
    <span class="nav-link" onclick="toggleDropdown('scaleDropdown'); event.stopPropagation();">
        Scale and Elevate â–¾
    </span>
    <div class="dropdown-content" id="scaleDropdown">
        <a href="#" class="dropdown-item">Founder Emergence</a>
        <a href="#" class="dropdown-item">Referrals</a>
        <a href="#" class="dropdown-item">Contacts</a>
        <a href="#" class="dropdown-item">My Trials</a>
    </div>
</div>
    </div>

    <div class="top-nav-right">
        <div class="icon-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
        </div>

        <div class="icon-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5
                         a2 2 0 0 1 2-2h14
                         a2 2 0 0 1 2 2z"></path>
            </svg>
        </div>

        <div class="profile-dropdown">
<div class="icon-btn" onclick="toggleDashProfileDropdown()">
    ${founderData?.photoURL 
        ? `<img src="${founderData.photoURL}" alt="Profile" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">` 
        : `<div style="font-size:1.2rem;font-weight:600;">${founderData.founderImage || 'U'}</div>`}
</div>

            <div class="profile-dropdown-content" id="dashProfileDropdown">
                <div class="profile-info">
                    <div class="profile-username">${founderData?.founderUsername || 'Username'}</div>
                    <div class="profile-userid">${founderData?.userId || 'USER_ID'}</div>
                </div>

                <button class="switch-btn">Switch to Browse</button>

                <div class="profile-section">
                    <a href="#" class="profile-link">Refer a Friend</a>
                    <a href="#" class="profile-link">Profile</a>
                    <a href="#" class="profile-link" onclick="auth.signOut();return false;">Log Out</a>
                </div>
            </div>
        </div>
    </div>
</nav>

<!-- MAIN DASHBOARD -->
<div class="container">

    <!-- LEFT -->
    <div class="left-section">
        <div class="left-cards">

            <div class="card">
              <div class="profile-avatar">${founderData?.photoURL 
    ? `<img src="${founderData.photoURL}" alt="Profile" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">` 
    : (founderData?.founderImage || 'U')}</div>

                <div class="card-title">${founderData?.founderUsername || 'Username'}</div>
                <div class="card-subtitle">${founderData?.userId || 'USER_ID'}</div>
               <button class="card-btn" onclick="window.location.hash='edit_founderprofile'">View Profile</button>
            </div>

             <div class="card">
            <div class="startup-logo">
                ${startupData?.logo
                    ? `<img src="${startupData.logo}" alt="Startup Logo">`
                    : `
                    <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5z"></path>
                        <path d="M2 17l10 5 10-5"></path>
                        <path d="M2 12l10 5 10-5"></path>
                    </svg>`}
            </div>

            <div class="card-title">${startupData?.startupName || 'My Startup'}</div>
            <div class="card-subtitle">${startupData?.startupId || ''}</div>
            <button class="card-btn" onclick="window.location.hash='edit_startup'">View Startup</button>
        </div>

<div class="card">
    <div class="availability-indicator">
        <svg width="35" height="35" viewBox="0 0 24 24"
             fill="none" stroke="black" stroke-width="3">
            <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
    </div>

    <div class="card-title">Founder Availability</div>

    <button class="card-btn">Set Availability</button>

    <p class="card-description">
        Control when you're available.
    </p>
</div>

<div class="card inbox-card">
    <div class="card-title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2"
             style="vertical-align:middle;margin-right:.5rem;">
            <path d="M22 12h-6l-2 3h-4l-2-3H2"></path>
            <path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16
                     a2 2 0 0 0 2-2v-6l-3.45-6.89"></path>
        </svg>
        Inbox
    </div>

    <div class="inbox-message">
        <strong>Welcome to ScaleVest!</strong><br>
        <small>Start connecting with investors today.</small>
    </div>
</div>


        </div>
    </div>

<!-- RIGHT -->
<div class="right-section">

    <!-- WELCOME -->
    <div class="welcome-section">
        <h1 class="welcome-text">
            Welcome, ${founderData?.founderUsername || 'Founder'}!
            <svg width="35" height="35" viewBox="0 0 24 24" fill="none"
                 stroke="white" stroke-width="2"
                 style="vertical-align:middle;margin-left:.5rem;">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        </h1>

        <p class="welcome-subtext">
            Let's make today count and connect with potential investors
        </p>
    </div>

    <!-- BANNERS -->
    <div class="banners-section">

        <div class="banner">
            <div class="banner-content">
                <h3>
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none"
                         stroke="white" stroke-width="2"
                         style="vertical-align:middle;margin-right:.5rem;">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    Start Founder Emergence
                </h3>
                <p>Launch your Founder Emergence campaign and reach investors faster.</p>
            </div>

            <div class="banner-icon">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none"
                     stroke="white" stroke-width="2">
                    <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27"></path>
                </svg>
            </div>
        </div>

        <div class="banner">
            <div class="banner-content">
                <h3>
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none"
                         stroke="white" stroke-width="2"
                         style="vertical-align:middle;margin-right:.5rem;">
                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8"></path>
                    </svg>
                    Setup Auto Reply for Investors
                </h3>
                <p>Respond instantly to investor messages with smart auto replies.</p>
            </div>

            <div class="banner-icon">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none"
                     stroke="white" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14"></path>
                </svg>
            </div>
        </div>

    </div>

    <!-- ACTIVE VESTS -->
    <div class="banner">
        <div class="banner-content">
            <h3>
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none"
                     stroke="white" stroke-width="2"
                     style="vertical-align:middle;margin-right:.5rem;">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
                Active Vests
            </h3>
            <p>Manage your investor outreach campaigns.</p>
        </div>

        <div class="banner-icon">
            <svg width="60" height="60" viewBox="0 0 24 24" fill="none"
                 stroke="white" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2"></rect>
            </svg>
        </div>
    </div>

</div>

</div>


<!-- FOOTER -->
<footer class="footer">
    <div class="footer-content">
        <div>
            <div class="footer-logo-text">ScaleVest</div>
            <div class="footer-company">UnioraX Private Limited</div>
        </div>
        <div class="footer-links">
            <a href="#" class="footer-link">About</a>
            <a href="#" class="footer-link">Contact</a>
            <a href="#" class="footer-link">Privacy</a>
            <a href="#" class="footer-link">Terms</a>
        </div>
    </div>
</footer>

    `;
    
    const container = document.getElementById('dashboardContainer');
    container.innerHTML = dashboardHTML;
    container.style.display = 'block';
    
    // Add dropdown interaction after DOM is loaded
    setTimeout(() => {
        window.toggleDashProfileDropdown = function() {
            const dropdown = document.getElementById('dashProfileDropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        };
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.dash-profile-dropdown')) {
                const dropdown = document.getElementById('dashProfileDropdown');
                if (dropdown) dropdown.classList.remove('show');
            }
        });
    }, 100);
}

// Close dropdowns when clicking outside
document.addEventListener('click', (e) => {
    if (!e.target.closest('.dropdown')) {
        document.querySelectorAll('.dropdown-content').forEach(dd => {
            dd.classList.remove('show');
        });
    }
});
function generateUserId(baseString) {
    // Generate PERMANENT userId that NEVER changes
    const timestamp = Date.now().toString().slice(-4);
    const randomNum = Math.floor(Math.random() * 900 + 100);
    return `USER_${timestamp}${randomNum}`;
}

// Show User ID Setup Modal
async function showUserIdSetupModal() {
    const modal = document.createElement('div');
    modal.className = 'edit-modal show';
    modal.style.zIndex = '99999';
    modal.innerHTML = `
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h3>âš¡ Set Your User ID</h3>
            </div>
            <div class="edit-modal-body">
                <p style="color: #aaa; margin-bottom: 1.5rem;">Choose a unique User ID that will identify you on ScaleVest</p>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">User ID</label>
                    <input type="text" id="userIdInput" placeholder="e.g., USER_1234" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 2px solid #333; border-radius: 8px; color: #fff; font-size: 1rem;">
                    <small style="color: #888; display: block; margin-top: 0.5rem;">This cannot be changed later</small>
                </div>
            </div>
            <div class="edit-modal-footer">
                <button class="modal-btn-save" onclick="saveUserId()" style="width: 100%;">Continue</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    document.getElementById('userIdInput').focus();
}

window.saveUserId = async function() {
    const userId = document.getElementById('userIdInput').value.trim();
    
    if (!userId || userId.length < 5) {
        alert('âŒ User ID must be at least 5 characters');
        return;
    }
    
    try {
        // Update founder profile with userId
        await update(ref(db, `founderProfile/${currentUser.uid}`), { userId });
        cachedFounderData.userId = userId;
        
        // Close modal and navigate
        document.querySelector('.edit-modal').remove();
        window.location.hash = 'vest_step1';
    } catch (error) {
        console.error('Error saving userId:', error);
        alert('âŒ Failed to save User ID');
    }
};

async function showEditProfile() {
    document.title = "Edit Profile | ScaleVest";
    document.querySelector('.vest-container').style.display = 'none';
    
    let container = document.getElementById('dashboardContainer');
    if (!container) {
        container = document.createElement('div');
        container.id = 'dashboardContainer';
        document.body.appendChild(container);
    }
    
    container.style.display = 'block';
    
    // FIX 1: Ensure founderData is loaded properly
    let founderData = cachedFounderData || {};
    const startupData = cachedStartupData || {};
    
// FIX 2: Convert old string format to new array format
if (!founderData.languages) {
    founderData.languages = [];
} else if (typeof founderData.languages === 'string') {
    // Old format: "HINDI" -> New format: [{name: "Hindi", level: "Fluent"}]
    const oldLang = founderData.languages.trim();
    founderData.languages = oldLang ? [{name: oldLang, level: 'Fluent'}] : [];
    // Save updated format to Firebase
    update(ref(db, `founderProfile/${currentUser.uid}`), { languages: founderData.languages });
} else if (!Array.isArray(founderData.languages)) {
    founderData.languages = [];
}
    
    // Fetch location data from startupProfile
    const locationData = startupData?.location || { country: '', state: '', city: '' };
    
    console.log('PROFILE DATA:', founderData); // DEBUG
    
    // Calculate profile completion
const fields = [
    founderData.founderUsername,
    founderData.photoURL,
    founderData.title,
    founderData.about,
    founderData.education?.length > 0,
    founderData.workExperience?.length > 0,
    founderData.coFounders && Object.keys(founderData.coFounders).length > 0,
    founderData.languages?.length > 0
];
const filledFields = fields.filter(f => f && f !== '').length;
const completionPercent = Math.round((filledFields / fields.length) * 100);  
    container.innerHTML = `
        <style>
        .top-nav {
            background: #0a0a0a;
            padding: 1.2rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #222;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .logo {
            font-size: 2rem;
            font-weight: 700;
            color: #fff;
            cursor: pointer;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .nav-links {
            display: flex;
            gap: 2.5rem;
            align-items: center;
        }

        .nav-link {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: #fff;
            transition: width 0.3s;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .dropdown {
            position: relative;
        }
@media (max-width: 768px) {
    .edit-profile-container {
        padding: 1rem;
    }
    
    .profile-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .profile-header-card {
        flex-direction: column;
        text-align: center;
    }
    
    .profile-avatar-large {
        width: 80px;
        height: 80px;
        font-size: 2rem;
    }
    
    .profile-name {
        font-size: 1.5rem;
    }
    
    .profile-card {
        padding: 1.5rem;
    }
    
    .dual-section {
        grid-template-columns: 1fr;
    }
    
    .edit-modal-content {
        width: 95%;
        max-height: 90vh;
    }
    
    .back-btn {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
    }
    
    .action-buttons {
        flex-direction: column;
        width: 100%;
    }
    
    .preview-btn, .share-btn {
        width: 100%;
    }
}
        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: #1a1a1a;
            min-width: 220px;
            border-radius: 12px;
            margin-top: 1rem;
            box-shadow: 0 10px 40px rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            overflow: hidden;
            z-index: 1000;
        }

        .dropdown-content.show {
            display: block !important;
            animation: fadeInDropdown 0.3s;
        }

        @keyframes fadeInDropdown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-item {
            padding: 1rem 1.5rem;
            color: #fff;
            text-decoration: none;
            display: block;
            transition: all 0.3s;
            cursor: pointer;
            border-left: 3px solid transparent;
        }

        .dropdown-item:hover {
            background: #222;
            border-left-color: #fff;
            padding-left: 2rem;
        }

        .top-nav-right {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            border: 1px solid #222;
        }

        .icon-btn:hover {
            background: #fff;
            border-color: #fff;
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
        }

        .icon-btn:hover svg {
            stroke: #000;
        }

        .profile-dropdown {
            position: relative;
        }

        .profile-dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: #1a1a1a;
            min-width: 300px;
            border-radius: 12px;
            margin-top: 1rem;
            box-shadow: 0 10px 40px rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            padding: 1rem;
            z-index: 1000;
        }

        .profile-dropdown-content.show {
            display: block;
            animation: fadeInDropdown 0.3s;
        }

        .profile-info {
            padding: 1rem;
            border-bottom: 1px solid #333;
            margin-bottom: 1rem;
        }

        .profile-username {
            font-weight: 600;
            font-size: 1.2rem;
        }

        .profile-userid {
            color: #888;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .switch-btn {
            background: #fff;
            color: #000;
            border: none;
            padding: 0.9rem;
            width: 100%;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            margin-bottom: 1rem;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .switch-btn:hover {
            background: #ddd;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.3);
        }

        .profile-section {
            padding: 0.5rem 0;
        }

        .profile-link {
            padding: 0.9rem 1rem;
            display: block;
            color: #fff;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
            font-weight: 500;
        }

        .profile-link:hover {
            background: #222;
            padding-left: 1.5rem;
        }
            .edit-profile-container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 2rem 3rem;
                background: #000;
                min-height: 100vh;
            }
            
            .profile-grid {
                display: grid;
                grid-template-columns: 1fr 300px;
                gap: 2rem;
                margin-top: 2rem;
            }
            
            .profile-main {
                display: flex;
                flex-direction: column;
                gap: 2rem;
            }
            
            .profile-sidebar {
                display: flex;
                flex-direction: column;
                gap: 2rem;
            }
            
            .profile-card {
                background: #0a0a0a;
                border: 1px solid #222;
                border-radius: 16px;
                padding: 2.5rem;
                transition: all 0.3s;
            }
            
            .profile-card:hover {
                border-color: #444;
                box-shadow: 0 10px 40px rgba(255, 255, 255, 0.05);
            }
            
            .profile-header-card {
                display: flex;
                align-items: center;
                gap: 2rem;
            }
            
            .profile-avatar-large {
                width: 120px;
                height: 120px;
                border-radius: 50%;
                background: #fff;
                color: #000;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 3rem;
                font-weight: 800;
                flex-shrink: 0;
            }
            
            .profile-header-info {
                flex: 1;
            }
            
            .profile-name-row {
                display: flex;
                align-items: center;
                gap: 1rem;
                margin-bottom: 0.5rem;
            }
            
            .profile-name {
                font-size: 2rem;
                font-weight: 700;
            }
            
.edit-icon-btn {
    width: 26px;        
    height: 26px;        
    flex-shrink: 0;     
    flex-grow: 0;            
     margin-left: auto; 
    border-radius: 4px;
    background: #1a1a1a;
    border: 1px solid #555;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    padding: 0;
}

.edit-icon-btn svg {
    width: 14px;
    height: 14px;
    stroke: #fff;
    flex-shrink: 0;
}

.edit-icon-btn:hover {
    background: #fff;
    border-color: #fff;
    transform: scale(1.05);
}

.edit-icon-btn:hover svg {
    stroke: #000;
}

.back-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: #1a1a1a;
    color: #fff;
    border: 2px solid #333;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    text-decoration: none;
    margin-bottom: 1.5rem;
}

.back-btn:hover {
    background: #fff;
    color: #000;
    border-color: #fff;
    transform: translateX(-5px);
}

.action-buttons {
    display: flex;
    gap: 0.75rem;
    margin-top: 0.5rem;
}

.preview-btn, .share-btn {
    padding: 0.6rem 1.2rem;
    border-radius: 8px;
    border: 2px solid #333;
    background: #1a1a1a;
    color: #fff;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    font-size: 0.9rem;
}

.preview-btn:hover, .share-btn:hover {
    background: #fff;
    color: #000;
    border-color: #fff;
    transform: translateY(-2px);
}

.location-info, .language-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-top: 1rem;
    padding: 1rem;
    background: #000;
    border-radius: 10px;
    border: 1px solid #222;
}

.location-info svg, .language-info svg {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
}

.info-content {
    flex: 1;
    color: #aaa;
}

.language-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.language-tag {
    background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
    border: 1px solid #444;
    color: #fff;
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.85rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.language-level {
    background: rgba(255, 255, 255, 0.15);
    padding: 0.2rem 0.5rem;
    border-radius: 10px;
    font-size: 0.75rem;
    color: #aaa;
}

.lang-remove-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: #fff;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
}

.lang-remove-btn:hover {
    background: rgba(255, 255, 255, 0.4);
}

.profile-avatar-large {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: #fff;
    color: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    font-weight: 800;
    flex-shrink: 0;
    position: relative;
    cursor: pointer;
    overflow: hidden;
}

.profile-avatar-large img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.avatar-edit-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s;
    gap: 0.5rem;
}

.profile-avatar-large:hover .avatar-edit-overlay {
    opacity: 1;
}

.avatar-edit-overlay svg {
    width: 30px;
    height: 30px;
    stroke: #fff;
}

.avatar-edit-overlay span {
    color: #fff;
    font-size: 0.85rem;
    font-weight: 600;
}            
            .profile-userid {
                color: #888;
                font-size: 1rem;
                margin-bottom: 1rem;
            }
            
            .profile-title {
                color: #aaa;
                font-size: 1.1rem;
                display: flex;
                align-items: center;
                gap: 0.75rem;
            }
            
            .section-title {
                font-size: 1.3rem;
                font-weight: 700;
                margin-bottom: 1.5rem;
            }
            
            .about-box {
                background: #000;
                border: 1px solid #222;
                border-radius: 12px;
                padding: 2rem;
                min-height: 150px;
                color: #aaa;
                line-height: 1.8;
                position: relative;
            }
            
            .about-box.empty {
                display: flex;
                align-items: center;
                justify-content: center;
                color: #666;
                font-style: italic;
            }
            
            .edit-details-btn {
                background: transparent;
                color: #fff;
                border: 2px solid #fff;
                padding: 0.9rem 2rem;
                border-radius: 10px;
                cursor: pointer;
                font-weight: 700;
                transition: all 0.3s;
                margin-top: 1.5rem;
                width: 100%;
            }
            
            .edit-details-btn:hover {
                background: #fff;
                color: #000;
                transform: translateY(-2px);
            }
            
            .startup-info-card {
                background: #000;
                border: 1px solid #222;
                border-radius: 12px;
                padding: 2rem;
                position: relative;
            }
            
            .startup-name {
                font-size: 1.4rem;
                font-weight: 700;
                margin-bottom: 1rem;
            }
            
            .startup-description {
                color: #aaa;
                line-height: 1.6;
            }
            
            .video-box {
                background: #000;
                border: 2px dashed #333;
                border-radius: 12px;
                padding: 3rem;
                text-align: center;
                min-height: 250px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 1.5rem;
            }
            
            .add-video-btn {
                background: linear-gradient(135deg, #ff006e, #8338ec);
                color: #fff;
                border: none;
                padding: 1rem 2.5rem;
                border-radius: 10px;
                cursor: pointer;
                font-weight: 700;
                transition: all 0.3s;
            }
            
            .add-video-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 30px rgba(255, 0, 110, 0.3);
            }
            
            .dual-section {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
            }
            
            .empty-state {
                text-align: center;
                padding: 2rem;
                color: #666;
            }
            
            .add-item-btn {
                background: #1a1a1a;
                color: #fff;
                border: 2px solid #333;
                padding: 0.8rem 1.5rem;
                border-radius: 8px;
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s;
                margin-top: 1rem;
            }
            
            .add-item-btn:hover {
                border-color: #fff;
                background: #222;
            }
            .experience-item {
    background: #000;
    border: 1px solid #222;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 1rem;
}

.exp-title {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.exp-subtitle {
    color: #aaa;
    font-size: 0.95rem;
    margin-bottom: 0.5rem;
}

/* --- FIXED MODAL & CLOSE BUTTON STYLES --- */

/* 1. The Black Background Overlay */
.edit-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9); /* Dark black background */
    backdrop-filter: blur(5px);           /* Blur effect */
    z-index: 99999;
    
    /* This centers the popup vertically and horizontally */
    display: flex;
    align-items: center;
    justify-content: center;
    
    /* Animation states */
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease;
}

/* Show state */
.edit-modal.show {
    opacity: 1;
    visibility: visible;
}

/* 2. The Popup Box */
.edit-modal-content {
    position: relative; /* Crucial: Makes the Close Button stick to this box */
    background: #111;
    border: 1px solid #333;
    border-radius: 16px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    transform: translateY(20px);
    transition: transform 0.3s ease;
    display: flex;
    flex-direction: column;
}

/* Slide animation when opening */
.edit-modal.show .edit-modal-content {
    transform: translateY(0);
}

/* 3. The Header (Title) */
.edit-modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid #222;
    width: 100%;
}

.edit-modal-header h3 {
    margin: 0;
    font-size: 1.3rem;
    color: #fff;
}

/* 4. The Close Button (EXTREME TOP RIGHT) */
.modal-close {
    position: absolute; /* Takes it out of the layout flow */
    top: 15px;          /* Distance from top edge */
    right: 20px;        /* Distance from right edge */
    background: transparent;
    border: none;
    color: #888;
    font-size: 2rem;
    line-height: 1;
    cursor: pointer;
    transition: all 0.2s;
    z-index: 10;
}

.modal-close:hover {
    color: #fff;
    transform: scale(1.1);
}

/* Body & Footer adjustments */
.edit-modal-body {
    padding: 1.5rem;
    text-align: left;
}

.edit-modal-footer {
    padding: 1.5rem;
    border-top: 1px solid #222;
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    background: #161616;
    border-radius: 0 0 16px 16px;
}

.modal-btn-save {
    padding: 10px 24px;
    background: linear-gradient(135deg, #ff006e, #8338ec);
    border: none;
    color: #fff;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
}






.exp-duration {
    color: #666;
    font-size: 0.85rem;
}
            .quick-links-card {
                background: #0a0a0a;
                border: 1px solid #222;
                border-radius: 16px;
                padding: 2rem;
            }
            
            .quick-link-btn {
                background: #1a1a1a;
                color: #fff;
                border: 1px solid #333;
                padding: 1rem;
                border-radius: 10px;
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s;
                width: 100%;
                text-align: left;
                margin-bottom: 0.75rem;
            }
            
            .quick-link-btn:hover {
                background: #222;
                border-color: #fff;
                transform: translateX(5px);
            }
            /* Upload Loading Animation */
.upload-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(10px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 99999;
    animation: fadeIn 0.3s;
}

.upload-spinner {
    width: 80px;
    height: 80px;
    border: 6px solid #333;
    border-top: 6px solid #fff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 1.5rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.upload-text {
    color: #fff;
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.upload-subtext {
    color: #888;
    font-size: 0.95rem;
}

.upload-progress-bar {
    width: 300px;
    height: 8px;
    background: #1a1a1a;
    border-radius: 10px;
    overflow: hidden;
    margin-top: 1.5rem;
}

.upload-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #ff006e, #8338ec);
    width: 0%;
    transition: width 0.3s;
    animation: progressPulse 1.5s ease-in-out infinite;
}

@keyframes progressPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}
            .progress-card {
                background: #0a0a0a;
                border: 1px solid #222;
                border-radius: 16px;
                padding: 2rem;
            }
            
            .progress-bar {
                width: 100%;
                height: 12px;
                background: #1a1a1a;
                border-radius: 10px;
                overflow: hidden;
                margin: 1rem 0;
            }
       .cofounder-item {
    background: #000;
    border: 1px solid #222;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 1rem;
}

.cofounder-name {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.cofounder-desc {
    color: #aaa;
    font-size: 0.9rem;
}     
            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #10b981, #3a86ff);
                transition: width 0.5s;
            }
            
            .progress-text {
                text-align: center;
                font-size: 2rem;
                font-weight: 700;
                color: #10b981;
            }
            
            @media (max-width: 1024px) {
                .profile-grid {
                    grid-template-columns: 1fr;
                }
                
                .dual-section {
                    grid-template-columns: 1fr;
                }
                
                .edit-profile-container {
                    padding: 2rem 1.5rem;
                }
            }
        </style>
        
        ${createNavBar()}
        
      <div class="edit-profile-container">
    <a href="#founder_dashboard" class="back-btn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back to Dashboard
    </a>
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1 class="welcome-text" style="margin: 0;">Edit Founder Profile</h1>
        <div class="action-buttons">
            <button class="preview-btn" onclick="alert('ðŸ” Preview feature coming soon!')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 0.3rem;">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
                Preview
            </button>
            <button class="share-btn" onclick="alert('ðŸ”— Share feature coming soon!')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 0.3rem;">
                    <circle cx="18" cy="5" r="3"></circle>
                    <circle cx="6" cy="12" r="3"></circle>
                    <circle cx="18" cy="19" r="3"></circle>
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                </svg>
                Share
            </button>
        </div>
    </div>
            
            <div class="profile-grid">
                <!-- Main Column -->
                <div class="profile-main">
                    <!-- Header Card -->
                   <div class="profile-card profile-header-card">
    <div class="profile-avatar-large" onclick="editProfilePhoto()">
        ${founderData.photoURL 
            ? `<img src="${founderData.photoURL}" alt="Profile">` 
            : founderData.founderImage || 'U'}
        <div class="avatar-edit-overlay">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
            </svg>
            <span>Edit Photo</span>
        </div>
    </div>
    <div class="profile-header-info">
        <div class="profile-name-row">
            <span class="profile-name">${founderData.founderUsername || 'Username'}</span>
            <button class="edit-icon-btn" onclick="editUsername()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>
        </div>
        
                
        <div class="profile-userid">${founderData.userId || 'USER_ID'}</div>
        
        <div class="profile-title">
            <span>${founderData.title || 'No title'}</span>
            <button class="edit-icon-btn" onclick="editTitle()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>
        </div>
    </div>
</div>



<!-- Location & Language Info Cards -->
<div class="profile-card">
    <div class="location-info">
        <svg viewBox="0 0 24 24" fill="none" stroke="#ff006e" stroke-width="2">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
        </svg>
        <div class="info-content">
            <strong>Location:</strong> ${locationData.city || 'N/A'}, ${locationData.state || 'N/A'}, ${locationData.country || 'N/A'}
        </div>
        <button class="edit-icon-btn" onclick="editLocation()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
        </button>
    </div>
    
    <div class="language-info" style="margin-top: 1rem;">
        <svg viewBox="0 0 24 24" fill="none" stroke="#8338ec" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="2" y1="12" x2="22" y2="12"></line>
            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
        </svg>
        <div class="info-content" style="flex: 1;">
            <strong>Languages:</strong>
            <div class="language-tags">
                ${founderData.languages && Array.isArray(founderData.languages) && founderData.languages.length > 0 
                    ? founderData.languages.map(lang => `
                        <span class="language-tag">
                            ${lang.name}
                            <span class="language-level">${lang.level}</span>
                            <button class="lang-remove-btn" onclick="removeLanguage('${lang.name}')">Ã—</button>
                        </span>
                    `).join('')
                    : '<span style="color: #666;">No languages added</span>'}
            </div>
        </div>
        <button class="edit-icon-btn" onclick="addLanguage()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        </button>
    </div>
</div>
                    
                    <!-- About Me Card -->
                    <div class="profile-card">
                        <h3 class="section-title">About Me</h3>
                        <div class="about-box ${founderData.about ? '' : 'empty'}">
                            ${founderData.about || 'Tell investors about yourself...'}
                        </div>
                        <button class="edit-details-btn" onclick="editAbout()">Edit Details</button>
                    </div>
                    
                    <!-- Startup Info Card -->
                    ${startupData ? `
                    <div class="profile-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 class="section-title" style="margin: 0;">Startup</h3>
                            <button class="edit-icon-btn" onclick="editStartup()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="startup-info-card">
                            <div class="startup-name">${startupData.startupName || 'Startup Name'}</div>
                            <div class="startup-description">${startupData.description || 'No description available'}</div>
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- Intro Video Card -->
                    <div class="profile-card">
                        <h3 class="section-title">Intro Video</h3>
                        <div class="video-box">
                            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                            <p style="color: #666;">No video yet</p>
                            <button class="add-video-btn" onclick="uploadVideo()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                Add Video
                            </button>
                        </div>
                    </div>
                    
                  <!-- Education & Work Experience -->
<div class="dual-section">
                <div class="profile-card">
                    <h3 class="section-title">Education</h3>
                    ${founderData?.education?.length > 0 ? `
                        ${founderData.education.map(edu => `
                            <div class="experience-item">
                                <div class="exp-title">${edu.degree}</div>
                                <div class="exp-subtitle">${edu.school}</div>
                                <div class="exp-duration">${edu.year}</div>
                            </div>
                        `).join('')}
                        <button class="add-item-btn" onclick="addEducation()">+ Add More</button>
                    ` : `
                        <div class="empty-state">
                            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2" style="margin-bottom: 1rem;">
                                <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
                                <path d="M6 12v5c3 3 9 3 12 0v-5"></path>
                            </svg>
                            <p>No education added yet</p>
                            <button class="add-item-btn" onclick="addEducation()">+ Add Education</button>
                        </div>
                    `}
                </div>
                
                <div class="profile-card">
                    <h3 class="section-title">Past Work</h3>
                    ${founderData?.workExperience?.length > 0 ? `
                        ${founderData.workExperience.map(work => `
                            <div class="experience-item">
                                <div class="exp-title">${work.position}</div>
                                <div class="exp-subtitle">${work.company}</div>
                                <div class="exp-duration">${work.duration}</div>
                            </div>
                        `).join('')}
                        <button class="add-item-btn" onclick="addWorkExperience()">+ Add More</button>
                    ` : `
                        <div class="empty-state">
                            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2" style="margin-bottom: 1rem;">
                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                            </svg>
                            <p>No past work yet</p>
                            <button class="add-item-btn" onclick="addWorkExperience()">+ Add Experience</button>
                        </div>
                    `}
                </div>
            </div> </div> <div class="profile-sidebar">
            <div class="quick-links-card">
                <h3 class="section-title">Quick Links</h3>
                <button class="quick-link-btn" onclick="window.location.hash='founder_dashboard'">
                    ðŸ“Š Dashboard
                </button>
                <button class="quick-link-btn" onclick="window.location.hash='vest_step1'">
                    ðŸš€ Create Vest
                </button>
                <button class="quick-link-btn">
                    ðŸ’¼ My Vests
                </button>
                <button class="quick-link-btn">
                    ðŸ“ˆ Analytics
                </button>
            </div>
            
            <div class="progress-card">
                <h3 class="section-title">Profile Completion</h3>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${completionPercent}%"></div>
                </div>
                <div class="progress-text">${completionPercent}%</div>
                <p style="color: #888; font-size: 0.9rem; text-align: center; margin-top: 1rem;">
                    Complete your profile to attract more investors
                </p>
            </div>                
                    
            ${founderData?.coFounders ? (
                Array.isArray(founderData.coFounders) && founderData.coFounders.length > 0 ? `
                <div class="profile-card">
                    <h3 class="section-title">Co-Founders</h3>
                    ${founderData.coFounders.map(coFounder => `
                        <div class="cofounder-item">
                            <div class="cofounder-name">${coFounder.name || 'No name'}</div>
                            <div class="cofounder-desc">${coFounder.description || 'No description'}</div>
                        </div>
                    `).join('')}
                    <button class="add-item-btn" onclick="addCoFounder()">+ Add Co-Founder</button>
                </div>
                ` : (Object.keys(founderData.coFounders).length > 0 ? `
                <div class="profile-card">
                    <h3 class="section-title">Co-Founders</h3>
                    ${Object.entries(founderData.coFounders).map(([id, coFounder]) => `
                        <div class="cofounder-item">
                            <div class="cofounder-name">${coFounder.name || 'No name'}</div>
                            <div class="cofounder-desc">${coFounder.description || 'No description'}</div>
                        </div>
                    `).join('')}
                    <button class="add-item-btn" onclick="addCoFounder()">+ Add Co-Founder</button>
                </div>
                ` : `
                <div class="profile-card">
                    <h3 class="section-title">Co-Founders</h3>
                    <div class="empty-state" style="padding: 1.5rem;">
                        <p style="color: #666; margin-bottom: 1rem;">No co-founders added</p>
                        <button class="add-item-btn" onclick="addCoFounder()">+ Add Co-Founder</button>
                    </div>
                </div>
                `)
            ) : `
            <div class="profile-card">
                <h3 class="section-title">Co-Founders</h3>
                <div class="empty-state" style="padding: 1.5rem;">
                    <p style="color: #666; margin-bottom: 1rem;">No co-founders added</p>
                    <button class="add-item-btn" onclick="addCoFounder()">+ Add Co-Founder</button>
                </div>
            </div>
            `}
        </div> </div> `;
}
// ============================================
// EDIT PROFILE FUNCTIONS - ALL WORKING
// ============================================

// Ensure this variable exists globally
let currentEditAction = null;

function createEditModal(title, val, ph, isArea, callback) {
    currentEditAction = callback; 
    const m = document.createElement('div');
    m.className = 'edit-modal show'; // Triggers CSS transition
    m.innerHTML = `
        <div class="edit-modal-content">
            <div class="edit-modal-header"><h3>${title}</h3><button class="modal-close" onclick="closeEditModal()">Ã—</button></div>
            <div class="edit-modal-body">
                ${isArea ? `<textarea id="editInput" rows="5" placeholder="${ph}">${val}</textarea>` : `<input type="text" id="editInput" value="${val}" placeholder="${ph}">`}
            </div>
            <div class="edit-modal-footer">
                <button class="modal-btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="modal-btn-save" onclick="saveEditModal()">Save</button>
            </div>
        </div>`;
    document.body.appendChild(m);
    setTimeout(() => document.getElementById('editInput').focus(), 100);
}

window.closeEditModal = function() {
    const modal = document.querySelector('.edit-modal');
    if (modal) modal.remove();
};

window.saveEditModal = function() {
    const value = document.getElementById('editInput').value.trim();
    if (currentEditAction) {
        currentEditAction(value);
    }
};
window.editUsername = function() {
    currentEditAction = async (newValue) => {
        if (!newValue || newValue === cachedFounderData?.founderUsername) return;
        
        try {
            const firstLetter = newValue.charAt(0).toUpperCase();
            const updates = {
                founderUsername: newValue,
                founderImage: firstLetter
                // DO NOT UPDATE userId - it stays permanent
            };
            
            await update(ref(db, `founderProfile/${currentUser.uid}`), updates);
            cachedFounderData = { ...cachedFounderData, ...updates };
            
            alert('âœ… Username updated successfully!');
            showEditProfile();
        } catch (error) {
            console.error('Error updating username:', error);
            alert('âŒ Failed to update username');
        }
    };
    
    createEditModal('Edit Username', cachedFounderData?.founderUsername || '', 'Enter your username');
};
window.editTitle = function() {
    currentEditAction = async (newValue) => {
        if (newValue === cachedFounderData?.title) return;
        
        try {
            const updates = { title: newValue };
            await update(ref(db, `founderProfile/${currentUser.uid}`), updates);
            cachedFounderData = { ...cachedFounderData, ...updates };
            
            alert('âœ… Title updated successfully!');
            showEditProfile();
        } catch (error) {
            console.error('Error updating title:', error);
            alert('âŒ Failed to update title');
        }
    };
    
    createEditModal('Edit Title', cachedFounderData?.title || '', 'e.g., CEO & Founder');
};
window.addCoFounder = function() {
    const modal = document.createElement('div');
    modal.className = 'edit-modal';
    modal.innerHTML = `
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h3>Add Co-Founder</h3>
                <button class="modal-close" onclick="closeEditModal()">Ã—</button>
            </div>
            <div class="edit-modal-body">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Co-Founder Name</label>
                    <input type="text" id="cofounderName" placeholder="Enter name" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Description (Optional)</label>
                    <textarea id="cofounderDesc" placeholder="e.g., CTO, 10 years in tech..." rows="3" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;"></textarea>
                </div>
            </div>
            <div class="edit-modal-footer">
                <button class="modal-btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="modal-btn-save" onclick="saveCoFounder()">Add Co-Founder</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    setTimeout(() => modal.classList.add('show'), 10);
};

window.saveCoFounder = async function() {
    const name = document.getElementById('cofounderName').value.trim();
    const description = document.getElementById('cofounderDesc').value.trim();
    
    if (!name) {
        alert('âŒ Name is required');
        return;
    }
    
    try {
        const coFounders = cachedFounderData?.coFounders || {};
        const newId = `founder_${Object.keys(coFounders).length}`;
        coFounders[newId] = { name, description };
        
        const updates = { coFounders };
        await update(ref(db, `founderProfile/${currentUser.uid}`), updates);
        cachedFounderData = { ...cachedFounderData, ...updates };
        
        closeEditModal();
        alert('âœ… Co-Founder added successfully!');
        showEditProfile();
    } catch (error) {
        console.error('Error adding co-founder:', error);
        alert('âŒ Failed to add co-founder');
    }
};
window.editAbout = function() {
    currentEditAction = async (newValue) => {
        if (newValue === cachedFounderData?.about) return;
        
        try {
            const updates = { about: newValue };
            await update(ref(db, `founderProfile/${currentUser.uid}`), updates);
            cachedFounderData = { ...cachedFounderData, ...updates };
            
            alert('âœ… About section updated successfully!');
            showEditProfile();
        } catch (error) {
            console.error('Error updating about:', error);
            alert('âŒ Failed to update about section');
        }
    };
    
    createEditModal('About Yourself', cachedFounderData?.about || '', 'Tell investors about yourself...', true);
};

window.editStartup = function() {
    const modal = document.createElement('div');
    modal.className = 'edit-modal';
    modal.innerHTML = `
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h3>Edit Startup Details</h3>
                <button class="modal-close" onclick="closeEditModal()">Ã—</button>
            </div>
            <div class="edit-modal-body">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Startup Name</label>
                    <input type="text" id="startupNameInput" placeholder="Enter startup name" value="${cachedStartupData?.startupName || ''}" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Description</label>
                    <textarea id="startupDescInput" placeholder="Describe your startup..." rows="4" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">${cachedStartupData?.description || ''}</textarea>
                </div>
            </div>
            <div class="edit-modal-footer">
                <button class="modal-btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="modal-btn-save" onclick="saveStartupEdit()">Save Changes</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    setTimeout(() => modal.classList.add('show'), 10);
};
// Edit Profile Photo
window.editProfilePhoto = async function() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    
    input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        if (file.size > 10 * 1024 * 1024) {
            alert('âŒ Image must be under 10MB');
            return;
        }
        
        // Show uploading overlay
        const overlay = document.createElement('div');
        overlay.className = 'upload-overlay';
        overlay.innerHTML = `
            <div class="upload-spinner"></div>
            <div class="upload-text">Uploading Photo...</div>
            <div class="upload-subtext">Please wait while we upload your photo</div>
            <div class="upload-progress-bar">
                <div class="upload-progress-fill" id="uploadProgressFill"></div>
            </div>
        `;
        document.body.appendChild(overlay);
        
        // Simulate progress animation
        let progress = 0;
        const progressInterval = setInterval(() => {
            progress += Math.random() * 15;
            if (progress > 90) progress = 90;
            document.getElementById('uploadProgressFill').style.width = progress + '%';
        }, 200);
        
        try {
            const photoURL = await uploadFileToStorage(file, 'profile-photos');
            
            // Complete progress
            clearInterval(progressInterval);
            document.getElementById('uploadProgressFill').style.width = '100%';
            
            const updates = { photoURL };
            await update(ref(db, `founderProfile/${currentUser.uid}`), updates);
            cachedFounderData = { ...cachedFounderData, ...updates };
            
            // Show success animation
            overlay.innerHTML = `
                <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" style="margin-bottom: 1rem;">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="16 8 10 14 8 12"></polyline>
                </svg>
                <div class="upload-text" style="color: #10b981;">Photo Uploaded!</div>
                <div class="upload-subtext">Refreshing your profile...</div>
            `;
            
            setTimeout(() => {
                overlay.remove();
                showEditProfile();
            }, 1500);
            
        } catch (error) {
            clearInterval(progressInterval);
            console.error('Error uploading photo:', error);
            
            // Show error animation
            overlay.innerHTML = `
                <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="#ff006e" stroke-width="2" style="margin-bottom: 1rem;">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
                <div class="upload-text" style="color: #ff006e;">Upload Failed</div>
                <div class="upload-subtext">Please try again</div>
            `;
            
            setTimeout(() => overlay.remove(), 2000);
        }
    };
    
    input.click();
};
function generateStartupId(startupName) {
    if (!startupName) return 'STARTUP_' + Math.floor(Math.random() * 9000 + 1000);
    
    // Clean startup name - take first 6 chars, convert to uppercase
    const cleanName = startupName.replace(/[^a-zA-Z0-9]/g, '').toUpperCase().slice(0, 6);
    
    // Generate unique number (timestamp-based + random)
    const uniqueNum = Date.now().toString().slice(-3) + Math.floor(Math.random() * 90 + 10);
    
    return `${cleanName}_${uniqueNum}`;
}
// Edit Location
window.editLocation = function() {
    const currentLocation = cachedStartupData?.location || { country: '', state: '', city: '' };
    
    const modal = document.createElement('div');
    modal.className = 'edit-modal';
    modal.innerHTML = `
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h3>Edit Location</h3>
                <button class="modal-close" onclick="closeEditModal()">Ã—</button>
            </div>
            <div class="edit-modal-body">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Country</label>
                    <input type="text" id="locationCountry" placeholder="e.g., United States" value="${currentLocation.country}" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">State/Province</label>
                    <input type="text" id="locationState" placeholder="e.g., California" value="${currentLocation.state}" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">City</label>
                    <input type="text" id="locationCity" placeholder="e.g., San Francisco" value="${currentLocation.city}" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">
                </div>
            </div>
            <div class="edit-modal-footer">
                <button class="modal-btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="modal-btn-save" onclick="saveLocation()">Save Location</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    setTimeout(() => modal.classList.add('show'), 10);
};

window.saveLocation = async function() {
    const country = document.getElementById('locationCountry').value.trim();
    const state = document.getElementById('locationState').value.trim();
    const city = document.getElementById('locationCity').value.trim();
    
    try {
        const updates = {
            location: { country, state, city }
        };
        
        await update(ref(db, `startupProfile/${currentUser.uid}`), updates);
        cachedStartupData = { ...cachedStartupData, ...updates };
        
        closeEditModal();
        alert('âœ… Location updated!');
        showEditProfile();
    } catch (error) {
        console.error('Error updating location:', error);
        alert('âŒ Failed to update location');
    }
};

// Add Language
window.addLanguage = function() {
    const modal = document.createElement('div');
    modal.className = 'edit-modal';
    modal.innerHTML = `
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h3>Add Language</h3>
                <button class="modal-close" onclick="closeEditModal()">Ã—</button>
            </div>
            <div class="edit-modal-body">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Language</label>
                    <input type="text" id="languageName" placeholder="e.g., English, Spanish, Hindi" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Proficiency Level</label>
                    <select id="languageLevel" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">
                        <option value="Beginner">Beginner</option>
                        <option value="Intermediate">Intermediate</option>
                        <option value="Fluent">Fluent</option>
                        <option value="Expert">Expert</option>
                    </select>
                </div>
            </div>
            <div class="edit-modal-footer">
                <button class="modal-btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="modal-btn-save" onclick="saveLanguage()">Add Language</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    setTimeout(() => modal.classList.add('show'), 10);
};

window.saveLanguage = async function() {
    const name = document.getElementById('languageName').value.trim();
    const level = document.getElementById('languageLevel').value;
    
    if (!name) {
        alert('âŒ Language name is required');
        return;
    }
    
    try {
        const languages = cachedFounderData?.languages || [];
        
        // Check if language already exists
        if (languages.some(lang => lang.name.toLowerCase() === name.toLowerCase())) {
            alert('âŒ Language already added');
            return;
        }
        
        languages.push({ name, level });
        
        const updates = { languages };
        await update(ref(db, `founderProfile/${currentUser.uid}`), updates);
        cachedFounderData = { ...cachedFounderData, ...updates };
        
        closeEditModal();
        alert('âœ… Language added!');
        showEditProfile();
    } catch (error) {
        console.error('Error adding language:', error);
        alert('âŒ Failed to add language');
    }
};

window.removeLanguage = async function(languageName) {
    if (!confirm(`Remove ${languageName}?`)) return;
    
    try {
        const languages = cachedFounderData?.languages?.filter(lang => lang.name !== languageName) || [];
        
        const updates = { languages };
        await update(ref(db, `founderProfile/${currentUser.uid}`), updates);
        cachedFounderData = { ...cachedFounderData, ...updates };
        
        alert('âœ… Language removed!');
        showEditProfile();
    } catch (error) {
        console.error('Error removing language:', error);
        alert('âŒ Failed to remove language');
    }
};
window.saveStartupEdit = async function() {
    const newName = document.getElementById('startupNameInput').value;
    const newDesc = document.getElementById('startupDescInput').value;
    
    if (!newName) {
        alert('âŒ Startup name is required');
        return;
    }
    
    try {
        const updates = {
            startupName: newName,
            description: newDesc
            // DO NOT UPDATE startupId - it stays permanent
        };
        
        await update(ref(db, `startupProfile/${currentUser.uid}`), updates);
        cachedStartupData = { ...cachedStartupData, ...updates };
        
        closeEditModal();
        alert('âœ… Startup info updated successfully!');
        showEditProfile();
    } catch (error) {
        console.error('Error updating startup:', error);
        alert('âŒ Failed to update startup');
    }
};
window.saveEditModal = function() {
    const value = document.getElementById('editInput').value.trim();
    if (currentEditAction) {
        currentEditAction(value);
    }
    closeEditModal();
};

window.uploadVideo = async function() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'video/*';
    
    input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        if (file.size > 50 * 1024 * 1024) {
            alert('âŒ Video must be under 50MB');
            return;
        }
        
        // Show uploading overlay
        const overlay = document.createElement('div');
        overlay.className = 'upload-overlay';
        overlay.innerHTML = `
            <div class="upload-spinner"></div>
            <div class="upload-text">Uploading Video...</div>
            <div class="upload-subtext">This may take a minute for larger files</div>
            <div class="upload-progress-bar">
                <div class="upload-progress-fill" id="uploadProgressFill"></div>
            </div>
        `;
        document.body.appendChild(overlay);
        
        // Simulate progress
        let progress = 0;
        const progressInterval = setInterval(() => {
            progress += Math.random() * 10;
            if (progress > 90) progress = 90;
            document.getElementById('uploadProgressFill').style.width = progress + '%';
        }, 300);
        
        try {
            const videoUrl = await uploadFileToStorage(file, 'intro-videos');
            
            clearInterval(progressInterval);
            document.getElementById('uploadProgressFill').style.width = '100%';
            
            const updates = { introVideo: videoUrl };
            await update(ref(db, `founderProfile/${currentUser.uid}`), updates);
            cachedFounderData = { ...cachedFounderData, ...updates };
            
            overlay.innerHTML = `
                <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" style="margin-bottom: 1rem;">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="16 8 10 14 8 12"></polyline>
                </svg>
                <div class="upload-text" style="color: #10b981;">Video Uploaded!</div>
                <div class="upload-subtext">Refreshing your profile...</div>
            `;
            
            setTimeout(() => {
                overlay.remove();
                showEditProfile();
            }, 1500);
            
        } catch (error) {
            clearInterval(progressInterval);
            console.error('Error uploading video:', error);
            
            overlay.innerHTML = `
                <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="#ff006e" stroke-width="2" style="margin-bottom: 1rem;">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
                <div class="upload-text" style="color: #ff006e;">Upload Failed</div>
                <div class="upload-subtext">Please try again</div>
            `;
            
            setTimeout(() => overlay.remove(), 2000);
        }
    };
    
    input.click();
};
window.addEducation = function() {
    const modal = document.createElement('div');
    modal.className = 'edit-modal';
    modal.innerHTML = `
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h3>Add Education</h3>
                <button class="modal-close" onclick="closeEditModal()">Ã—</button>
            </div>
            <div class="edit-modal-body">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">School/University</label>
                    <input type="text" id="eduSchool" placeholder="e.g., Stanford University" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Degree/Course</label>
                    <input type="text" id="eduDegree" placeholder="e.g., B.Tech Computer Science" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Year</label>
                    <input type="text" id="eduYear" placeholder="e.g., 2018-2022" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">
                </div>
            </div>
            <div class="edit-modal-footer">
                <button class="modal-btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="modal-btn-save" onclick="saveEducation()">Add Education</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    setTimeout(() => modal.classList.add('show'), 10);
};

window.saveEducation = async function() {
    const school = document.getElementById('eduSchool').value.trim();
    const degree = document.getElementById('eduDegree').value.trim();
    const year = document.getElementById('eduYear').value.trim();
    
    if (!school || !degree) {
        alert('âŒ School and degree are required');
        return;
    }
    
    try {
        const education = cachedFounderData?.education || [];
        education.push({ school, degree, year });
        
        const updates = { education };
        await update(ref(db, `founderProfile/${currentUser.uid}`), updates);
        cachedFounderData = { ...cachedFounderData, ...updates };
        
        closeEditModal();
        alert('âœ… Education added successfully!');
        showEditProfile();
    } catch (error) {
        console.error('Error adding education:', error);
        alert('âŒ Failed to add education');
    }
};

window.addWorkExperience = function() {
    const modal = document.createElement('div');
    modal.className = 'edit-modal';
    modal.innerHTML = `
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h3>Add Work Experience</h3>
                <button class="modal-close" onclick="closeEditModal()">Ã—</button>
            </div>
            <div class="edit-modal-body">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Company Name</label>
                    <input type="text" id="workCompany" placeholder="e.g., Google" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Position/Role</label>
                    <input type="text" id="workPosition" placeholder="e.g., Software Engineer" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Duration</label>
                    <input type="text" id="workDuration" placeholder="e.g., 2020-2023" style="width: 100%; padding: 0.75rem; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff;">
                </div>
            </div>
            <div class="edit-modal-footer">
                <button class="modal-btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="modal-btn-save" onclick="saveWorkExperience()">Add Experience</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    setTimeout(() => modal.classList.add('show'), 10);
};

window.saveWorkExperience = async function() {
    const company = document.getElementById('workCompany').value.trim();
    const position = document.getElementById('workPosition').value.trim();
    const duration = document.getElementById('workDuration').value.trim();
    
    if (!company || !position) {
        alert('âŒ Company and position are required');
        return;
    }
    
    try {
        const workExperience = cachedFounderData?.workExperience || [];
        workExperience.push({ company, position, duration });
        
        const updates = { workExperience };
        await update(ref(db, `founderProfile/${currentUser.uid}`), updates);
        cachedFounderData = { ...cachedFounderData, ...updates };
        
        closeEditModal();
        alert('âœ… Work experience added successfully!');
        showEditProfile();
    } catch (error) {
        console.error('Error adding work experience:', error);
        alert('âŒ Failed to add work experience');
    }
};


window.filterVests = function(type) {
    alert(`Filtering ${type} vests - feature coming soon!`);
};
    function addSafeListener(id, event, handler) {
        const el = document.getElementById(id);
        if (el) {
            el.addEventListener(event, handler);
        }
    }

    // 2. Tags/Keywords logic (Wrapped safely)
    const keywordInput = document.getElementById('keywordInput');
    const tagsContainer = document.getElementById('tagsContainer');

    if (keywordInput && tagsContainer) {
        keywordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const value = this.value.trim();
                if (value && keywords.length < 5 && !keywords.includes(value)) {
                    keywords.push(value);
                    addTagPill(value);
                    this.value = '';
                } else if (keywords.length >= 5) {
                    alert('Maximum 5 keywords allowed');
                }
            }
        });
    }

    // UI File listeners (Wrapped safely)
    addSafeListener('pitchDeck', 'change', (e) => {
        if (e.target.files[0]) document.getElementById('pitchDeckName').textContent = 'âœ“ ' + e.target.files[0].name;
    });

    addSafeListener('transactionProof', 'change', (e) => {
        if (e.target.files[0]) document.getElementById('transactionProofName').textContent = 'âœ“ ' + e.target.files[0].name;
    });
    
    addSafeListener('demoVideo', 'change', (e) => {
        if (e.target.files[0]) document.getElementById('demoVideoName').textContent = 'âœ“ ' + e.target.files[0].name;
    });

    function addTagPill(keyword) {
        const pill = document.createElement('div');
        pill.className = 'tag-pill';
        pill.innerHTML = `${keyword} <button class="tag-remove" onclick="removeTag('${keyword}')">Ã—</button>`;
        tagsContainer.appendChild(pill);
    }

    window.removeTag = function(keyword) {
        keywords = keywords.filter(k => k !== keyword);
        updateTagsDisplay();
    };

// REPLACE your existing updateTagsDisplay function with this:
function updateTagsDisplay() {
    const tagsContainer = document.getElementById('tagsContainer');
    
    // SAFETY CHECK: If the element is missing, stop immediately to prevent crash
    if (!tagsContainer) return; 
    
    tagsContainer.innerHTML = '';
    if (typeof keywords !== 'undefined' && Array.isArray(keywords)) {
        keywords.forEach(keyword => addTagPill(keyword));
    }
}

// Auto-save on input change
document.addEventListener('input', (e) => {
    if (e.target.matches('input, textarea, select')) {
        saveToLocalStorage();
    }
});

// Load saved data on page load
window.addEventListener('load', () => {
    setTimeout(loadFromLocalStorage, 500);
});



    
function updateStepDisplay() {
    // Hide all steps
    document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
    
    // Show current step
    const currentStepEl = document.querySelector(`.step-content[data-step="${currentStep}"]`);
    if (currentStepEl) {
        currentStepEl.classList.add('active');
        console.log(`âœ… Showing step ${currentStep}`); // Debug log
    } else {
        console.error(`âŒ Step ${currentStep} element not found!`); // Debug log
    }
    
    // Update step indicators
    document.querySelectorAll('.step-indicator').forEach((el, index) => {
        el.classList.remove('active', 'completed');
        if (index + 1 === currentStep) {
            el.classList.add('active');
        } else if (index + 1 < currentStep) {
            el.classList.add('completed');
        }
    });
}

    // 4. File Upload Logic
    async function uploadFileToStorage(file, folder) {
        if (!file || !currentUser) return null;
        const fileName = `${folder}/${currentUser.uid}/${Date.now()}_${file.name}`;
        const fileRef = storageRef(storage, fileName);
        try {
            await uploadBytes(fileRef, file);
            return await getDownloadURL(fileRef);
        } catch (error) {
            console.error('Upload error:', error);
            return null;
        }
    }

   async function processAllFiles() {
    // Safely check and upload files only if they exist
    const pitchFile = document.getElementById('pitchDeck')?.files?.[0];
    const demoFile = document.getElementById('demoVideo')?.files?.[0];

    if (pitchFile && !uploadedFiles.pitchDeck) {
        uploadedFiles.pitchDeck = await uploadFileToStorage(pitchFile, 'pitch-decks');
    }
    
    if (demoFile && !uploadedFiles.demoVideo) {
        uploadedFiles.demoVideo = await uploadFileToStorage(demoFile, 'demo-videos');
    }
    
 }

    // 5. Data Collection & Saving
 window.collectVestData = function() {
    // 1. Get User ID (Safety Fallback)
    const uid = currentUser ? currentUser.uid : (cachedFounderData?.userId || 'GUEST');

    // 2. Co-founder Logic (Safe)
    const cofounders = [];
    const countInput = document.getElementById('cofounderCount');
    const cofounderCount = countInput ? (parseInt(countInput.value) || 0) : 0;
    
    for (let i = 1; i <= cofounderCount; i++) {
        const nameEl = document.getElementById(`cofounder${i}Name`);
        const workEl = document.getElementById(`cofounder${i}Work`);
        if (nameEl && nameEl.value) {
            cofounders.push({ name: nameEl.value, work: workEl ? workEl.value : '' });
        }
    }

    // 3. Return Data Object (Using Safe Access ?.)
    return {
        MainVest: {
            vestHook: document.getElementById('vestHook')?.value || '',
            vestDescription: document.getElementById('vestDescription')?.value || '',
            currentProblem: document.getElementById('currentProblem')?.value || '',
            yourSolution: document.getElementById('yourSolution')?.value || '',
            whyBest: document.getElementById('whyBest')?.value || '',
            equityWilling: document.getElementById('equityWilling')?.value || '0',
            fundAsk: document.getElementById('fundAsk')?.value || '0',
        },
        StartupDetails: {
            startupName: document.getElementById('startupName')?.value || '',
            startupDescription: document.getElementById('startupDescription')?.value || '',
            category: document.getElementById('category')?.value || '',
            startupStage: document.getElementById('startupStage')?.value || '',
            currentRevenue: document.getElementById('currentRevenue')?.value || '0',
            valuation: document.getElementById('valuation')?.value || '0',
            pitchDeckUrl: uploadedFiles?.pitchDeck || '',
        },
        Audit: {
            canScale: document.querySelector('input[name="canScale"]:checked')?.value || '',
            scaleExplanation: document.getElementById('scaleExplanation')?.value || '',
            marketShare: document.getElementById('marketShare')?.value || '',
            competitors: document.getElementById('competitors')?.value || '',
            whyBetter: document.getElementById('whyBetter')?.value || '',
            monetizationIdea: document.getElementById('monetizationIdea')?.value || '',
        },
        Roadmap: {
            fundingPlans: document.getElementById('fundingPlans')?.value || '',
            yearGoal: document.getElementById('yearGoal')?.value || '',
            threeYearVision: document.getElementById('threeYearVision')?.value || '',
            fundStrategy: document.getElementById('fundStrategy')?.value || '',
        },
        FounderPresence: {
            founderName: document.getElementById('founderName')?.value || '',
            hasCofounder: document.querySelector('input[name="hasCofounder"]:checked')?.value || 'no',
            cofounders: cofounders,
            demoVideoUrl: uploadedFiles?.demoVideo || '',
            founderWork: document.getElementById('founderWork')?.value || '',
        },
        createdAt: new Date().toISOString(),
        userId: uid,
    };
};



async function showEditStartup() {
    document.title = "Edit Startup | ScaleVest";
    document.querySelector('.vest-container').style.display = 'none';

    let container = document.getElementById('dashboardContainer');
    if (!container) {
        container = document.createElement('div');
        container.id = 'dashboardContainer';
        document.body.appendChild(container);
    }
    container.style.display = 'block';

    let startupData = cachedStartupData || {};
    
    // Ensure startup data is loaded
    if (!startupData || !startupData.startupName) {
        const startupProfileRef = ref(db, `startupProfile/${currentUser.uid}`);
        const startupSnap = await get(startupProfileRef);
        if (startupSnap.exists()) {
            startupData = startupSnap.val();
            cachedStartupData = startupData;
        }
    }
const startupFields = [
        startupData.startupName,
        startupData.logo,
        startupData.hookPitch,
        startupData.description,        // Short description
        startupData.companyDescription, // Long description
        startupData.stage,
        startupData.yearEstablished,
        startupData.category,
        startupData.monetization,
        startupData.revenue,            // Number checks
        startupData.userCount,
        startupData.valuation,
        startupData.location?.country,
        startupData.introVideo,
        startupData.team && startupData.team.length > 0
    ];

    // Filter valid fields (checks for not null, not undefined, not empty string)
    const filledStartup = startupFields.filter(f => f !== null && f !== undefined && f !== '').length;
    const startupPercent = Math.round((filledStartup / startupFields.length) * 100);
    // --- GENERATE TEAM LIST HTML ---
    const teamListHTML = (startupData.team && startupData.team.length > 0) 
        ? startupData.team.map(member => `
            <div class="team-member-row">
                <div class="member-avatar-circle">
                    ${member.name.charAt(0).toUpperCase()}
                </div>
                <div class="member-details">
                    <span class="member-name">${member.name}</span>
                    <span class="member-role">${member.role}</span>
                </div>
                <button onclick="removeTeamMember(${member.id})" style="background:none; border:none; color:#666; cursor:pointer; font-size:1.5rem; line-height:1;">&times;</button>
            </div>
        `).join('')
        : `<div class="empty-state" style="border: 1px dashed #333; border-radius: 12px; padding: 1.5rem; text-align: center;">
               <p style="color: #555; font-size: 0.9rem;">No team members added yet.</p>
           </div>`;

    container.innerHTML = `
        <style>
        .edit-profile-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 3rem;
            background: #000;
            min-height: 100vh;
        }
        
        .profile-grid {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
            margin-top: 2rem;
            align-items: start;
        }
        
        .profile-main {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            min-width: 0;
        }
        
        .profile-sidebar {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            position: sticky;
            top: 100px;
        }
        
        .profile-card {
            background: #0a0a0a;
            border: 1px solid #222;
            border-radius: 16px;
            padding: 2.5rem;
            transition: all 0.3s;
        }
        
        .profile-card:hover {
            border-color: #444;
            box-shadow: 0 10px 40px rgba(255, 255, 255, 0.05);
        }

        /* TEAM STYLES */
        .team-member-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #000;
            border: 1px solid #222;
            border-radius: 10px;
            margin-bottom: 0.75rem;
            transition: all 0.3s;
        }
        .team-member-row:hover { border-color: #444; }
        .member-avatar-circle {
            width: 40px; height: 40px; background: #1a1a1a; border: 1px solid #333;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: #fff; font-weight: 600; flex-shrink: 0;
        }
        .member-details { flex: 1; }
        .member-name { display: block; font-weight: 600; color: #fff; font-size: 1rem; }
        .member-role { display: block; color: #888; font-size: 0.85rem; }
        
        /* HEADER & INFO STYLES */
        .startup-header-card { display: flex; align-items: center; gap: 2rem; }
        .startup-logo-large { width: 120px; height: 120px; border-radius: 16px; background: #1a1a1a; display: flex; align-items: center; justify-content: center; flex-shrink: 0; position: relative; cursor: pointer; overflow: hidden; border: 2px solid #333; }
        .startup-logo-large img { width: 100%; height: 100%; object-fit: cover; }
        .logo-edit-overlay { position: absolute; inset: 0; background: rgba(0, 0, 0, 0.7); display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; gap: 0.5rem; }
        .startup-logo-large:hover .logo-edit-overlay { opacity: 1; }
        .logo-edit-overlay svg { width: 30px; height: 30px; stroke: #fff; }
        .logo-edit-overlay span { color: #fff; font-size: 0.85rem; font-weight: 600; }
        .startup-header-info { flex: 1; }
        .startup-name-row { display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem; }
 .top-nav {
            background: #0a0a0a;
            padding: 1.2rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #222;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .logo {
            font-size: 2rem;
            font-weight: 700;
            color: #fff;
            cursor: pointer;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .nav-links {
            display: flex;
            gap: 2.5rem;
            align-items: center;
        }

        .nav-link {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: #fff;
            transition: width 0.3s;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .dropdown {
            position: relative;
        }
@media (max-width: 768px) {
    .edit-profile-container {
        padding: 1rem;
    }
    
    .profile-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .profile-header-card {
        flex-direction: column;
        text-align: center;
    }
    
    .profile-avatar-large {
        width: 80px;
        height: 80px;
        font-size: 2rem;
    }
    
    .profile-name {
        font-size: 1.5rem;
    }
    
    .profile-card {
        padding: 1.5rem;
    }
    
    .dual-section {
        grid-template-columns: 1fr;
    }
    
    .edit-modal-content {
        width: 95%;
        max-height: 90vh;
    }
    
    .back-btn {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
    }
    
    .action-buttons {
        flex-direction: column;
        width: 100%;
    }
    
    .preview-btn, .share-btn {
        width: 100%;
    }
}
        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: #1a1a1a;
            min-width: 220px;
            border-radius: 12px;
            margin-top: 1rem;
            box-shadow: 0 10px 40px rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            overflow: hidden;
            z-index: 1000;
        }

        .dropdown-content.show {
            display: block !important;
            animation: fadeInDropdown 0.3s;
        }

        @keyframes fadeInDropdown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
/* ========================================= */
/* GLOBAL POPUP / MODAL STYLES (FIXED)      */
/* ========================================= */
.edit-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.9); /* Darker backdrop */
    backdrop-filter: blur(5px);     /* Blur effect */
    display: flex;
    align-items: center;            /* Center Vertically */
    justify-content: center;        /* Center Horizontally */
    z-index: 999999;                /* On top of everything */
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.edit-modal.show {
    opacity: 1;
    visibility: visible;
}

.edit-modal-content {
position: relative;
    background: #111;
    border: 1px solid #333;
    border-radius: 16px;
    width: 90%;
    max-width: 450px;
    padding: 0;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.7);
    transform: translateY(20px);
    transition: transform 0.3s ease;
    overflow: hidden;
}

.edit-modal.show .edit-modal-content {
    transform: translateY(0);
}

.edit-modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid #222;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #161616;
}

.edit-modal-header h3 {
    margin: 0;
    font-size: 1.2rem;
    color: #fff;
}

.modal-close {
    position: absolute;
    top: 15px;        
    right: 20px;        
    background: transparent;
    border: none;
    color: #888;
    font-size: 2rem;
    line-height: 1;
    cursor: pointer;
    transition: all 0.2s;
    z-index: 10;
}

.modal-close:hover { color: #fff; }

.edit-modal-body {
    padding: 1.5rem;
}

.edit-modal-body label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #ccc;
    font-size: 0.9rem;
}

.edit-modal-body input,
.edit-modal-body textarea,
.edit-modal-body select {
    width: 100%;
    padding: 12px;
    background: #0a0a0a;
    border: 1px solid #333;
    border-radius: 8px;
    color: #fff;
    font-size: 1rem;
    outline: none;
    margin-bottom: 1rem;
}

.edit-modal-body input:focus, 
.edit-modal-body textarea:focus {
    border-color: #ff006e;
}

.edit-modal-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid #222;
    background: #161616;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.modal-btn-cancel {
    padding: 10px 20px;
    background: transparent;
    border: 1px solid #333;
    color: #ccc;
    border-radius: 8px;
    cursor: pointer;
}

.modal-btn-save {
    padding: 10px 24px;
    background: linear-gradient(135deg, #ff006e, #8338ec);
    border: none;
    color: #fff;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
}
        .dropdown-item {
            padding: 1rem 1.5rem;
            color: #fff;
            text-decoration: none;
            display: block;
            transition: all 0.3s;
            cursor: pointer;
            border-left: 3px solid transparent;
        }

        .dropdown-item:hover {
            background: #222;
            border-left-color: #fff;
            padding-left: 2rem;
        }

        .top-nav-right {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            border: 1px solid #222;
        }

        .icon-btn:hover {
            background: #fff;
            border-color: #fff;
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
        }

        .icon-btn:hover svg {
            stroke: #000;
        }

        .profile-dropdown {
            position: relative;
        }

        .profile-dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: #1a1a1a;
            min-width: 300px;
            border-radius: 12px;
            margin-top: 1rem;
            box-shadow: 0 10px 40px rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            padding: 1rem;
            z-index: 1000;
        }

        .profile-dropdown-content.show {
            display: block;
            animation: fadeInDropdown 0.3s;
        }

        .profile-info {
            padding: 1rem;
            border-bottom: 1px solid #333;
            margin-bottom: 1rem;
        }

        .profile-username {
            font-weight: 600;
            font-size: 1.2rem;
        }

        .profile-userid {
            color: #888;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .switch-btn {
            background: #fff;
            color: #000;
            border: none;
            padding: 0.9rem;
            width: 100%;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            margin-bottom: 1rem;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .switch-btn:hover {
            background: #ddd;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.3);
        }

        .profile-section {
            padding: 0.5rem 0;
        }

        .profile-link {
            padding: 0.9rem 1rem;
            display: block;
            color: #fff;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
            font-weight: 500;
        }

        .profile-link:hover {
            background: #222;
            padding-left: 1.5rem;
        }
            .edit-profile-container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 2rem 3rem;
                background: #000;
                min-height: 100vh;
            }
            
            .profile-grid {
                display: grid;
                grid-template-columns: 1fr 300px;
                gap: 2rem;
                margin-top: 2rem;
            }
            
            .profile-main {
                display: flex;
                flex-direction: column;
                gap: 2rem;
            }
            
            .profile-sidebar {
                display: flex;
                flex-direction: column;
                gap: 2rem;
            }
            
            .profile-card {
                background: #0a0a0a;
                border: 1px solid #222;
                border-radius: 16px;
                padding: 2.5rem;
                transition: all 0.3s;
            }
            
            .profile-card:hover {
                border-color: #444;
                box-shadow: 0 10px 40px rgba(255, 255, 255, 0.05);
            }
            
            .profile-header-card {
                display: flex;
                align-items: center;
                gap: 2rem;
            }
            
            .profile-avatar-large {
                width: 120px;
                height: 120px;
                border-radius: 50%;
                background: #fff;
                color: #000;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 3rem;
                font-weight: 800;
                flex-shrink: 0;
            }
            
            .profile-header-info {
                flex: 1;
            }
            
            .profile-name-row {
                display: flex;
                align-items: center;
                gap: 1rem;
                margin-bottom: 0.5rem;
            }
            
            .profile-name {
                font-size: 2rem;
                font-weight: 700;
            }

        .startup-name-large { font-size: 2rem; font-weight: 700; }
        .startup-id { color: #888; font-size: 1rem; }
        .section-title { font-size: 1.3rem; font-weight: 700; margin-bottom: 1.5rem; }
        .info-row { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #000; border-radius: 10px; margin-bottom: 1rem; border: 1px solid #222; }
        .info-label { color: #888; font-size: 0.9rem; }
        .info-value { color: #fff; font-weight: 600; display: flex; align-items: center; gap: 0.75rem; }
        .not-set { color: #666; font-style: italic; }
        .edit-icon-btn {
    width: 26px;        
    height: 26px;        
    flex-shrink: 0;     
    flex-grow: 0;            
     margin-left: auto; 
    border-radius: 4px;
    background: #1a1a1a;
    border: 1px solid #555;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    padding: 0;
}

.edit-icon-btn svg {
    width: 14px;
    height: 14px;
    stroke: #fff;
    flex-shrink: 0;
}

        .edit-icon-btn:hover { background: #fff; border-color: #fff; transform: scale(1.05); }
        .edit-icon-btn:hover svg { stroke: #000; }
        .back-btn { display: inline-flex; align-items: center; gap: 0.5rem; background: #1a1a1a; color: #fff; border: 2px solid #333; padding: 0.75rem 1.5rem; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s; text-decoration: none; margin-bottom: 1.5rem; }
        .back-btn:hover { background: #fff; color: #000; border-color: #fff; transform: translateX(-5px); }
        .pitch-box { background: #000; border: 1px solid #222; border-radius: 12px; padding: 2rem; min-height: 100px; }
        .pitch-text { color: #aaa; line-height: 1.8; font-size: 1.1rem; }
        .upload-section { background: #000; border: 2px dashed #333; border-radius: 12px; padding: 2rem; text-align: center; margin-top: 1rem; }
/* ============================================= */
/* FORCE FIXES (Paste at bottom of <style>)     */
/* ============================================= */

/* 1. FIX THE WIDE BUTTON */
/* The global 'button { flex: 1 }' was forcing this to stretch. */
/* We reset flex properties to stop it from growing. */
button.upload-btn, 
.upload-btn {
    flex: 0 0 auto !important;       /* Don't grow, don't shrink, auto width */
    width: auto !important;          /* Use text width */
    min-width: 0 !important;         /* Prevent overflow lock */
    display: inline-flex !important; /* Keep neat inline box */
    align-items: center;
    justify-content: center;
    align-self: flex-start !important; /* Prevent stretching in column flex */
    margin-left: auto;               /* If in a row, push to the right */
    padding: 0.6rem 1.2rem !important;
    border-radius: 8px !important;
    font-size: 0.9rem !important;
    max-width: 200px !important;     /* Hard limit just in case */
}

/* 2. FIX THE MODAL CLOSE BUTTON POSITION */
/* Forces the container to be the anchor, and pins button to top-right */
.edit-modal-content {
    position: relative !important;   /* Essential for absolute positioning */
}

.modal-close {
    position: absolute !important;   /* Take out of layout flow */
    top: 15px !important;            /* 15px from top */
    right: 15px !important;          /* 15px from right */
    left: auto !important;           /* Override any centering */
    transform: none !important;      /* Remove centering transforms */
    background: transparent !important;
    border: none !important;
    width: 30px !important;
    height: 30px !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem !important;
    line-height: 1 !important;
    z-index: 50 !important;
    color: #888 !important;
    margin: 0 !important;            /* Remove interference margins */
}

.modal-close:hover {
    color: #fff !important;
    background: rgba(255,255,255,0.1) !important;
    border-radius: 50%;
}
        .pdf-viewer { width: 100%; height: 400px; border: 1px solid #333; border-radius: 10px; background: #000; margin-top: 1rem; }
        .progress-card, .quick-links-card { background: #0a0a0a; border: 1px solid #222; border-radius: 16px; padding: 2rem; }
        .progress-bar { width: 100%; height: 12px; background: #1a1a1a; border-radius: 10px; overflow: hidden; margin: 1rem 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #10b981, #3a86ff); transition: width 0.5s; }
        .progress-text { text-align: center; font-size: 2rem; font-weight: 700; color: #10b981; }
        .quick-link-btn { background: #1a1a1a; color: #fff; border: 1px solid #333; padding: 1rem; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s; width: 100%; text-align: left; margin-bottom: 0.75rem; }
        .quick-link-btn:hover { background: #222; border-color: #fff; transform: translateX(5px); }
        .description-box { background: #000; border: 1px solid #222; border-radius: 12px; padding: 2rem; min-height: 150px; color: #aaa; line-height: 1.8; }
        .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .photo-item { width: 100%; height: 150px; border-radius: 10px; overflow: hidden; border: 1px solid #333; }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; }
        
        @media (max-width: 1024px) {
            .profile-grid { grid-template-columns: 1fr; }
            .edit-profile-container { padding: 2rem 1.5rem; }
            .profile-sidebar { position: static; }
        }
        </style>
        
        ${createNavBar()}
        
        <div class="edit-profile-container">
            <a href="#founder_dashboard" class="back-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Back to Dashboard
            </a>
            
            <h1 class="welcome-text" style="margin-bottom: 2rem;">Startup Profile</h1>
            
            <div class="profile-grid">
                
                <div class="profile-main">
                    
                    <div class="profile-card startup-header-card">
                        <div class="startup-logo-large" onclick="editStartupLogo()">
                            ${startupData.logo 
                                ? `<img src="${startupData.logo}" alt="Startup Logo">` 
                                : `<svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2">
                                    <path d="M12 2L2 7l10 5 10-5z"></path>
                                    <path d="M2 17l10 5 10-5"></path>
                                    <path d="M2 12l10 5 10-5"></path>
                                   </svg>`}
                            <div class="logo-edit-overlay">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                                    <circle cx="12" cy="13" r="4"></circle>
                                </svg>
                                <span>Edit Logo</span>
                            </div>
                        </div>
                        <div class="startup-header-info">
                            <div class="startup-name-row">
                                <span class="startup-name-large">${startupData.startupName || 'Startup Name'}</span>
                                <button class="edit-icon-btn" onclick="editStartupName()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="startup-id">${startupData.startupId || 'STARTUP_ID'}</div>
                        </div>
                    </div>
                    
                    <div class="profile-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 class="section-title" style="margin: 0;">Hook Pitch</h3>
                            <button class="edit-icon-btn" onclick="editHookPitch()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="pitch-box">
                            <p class="pitch-text ${!startupData.hookPitch ? 'not-set' : ''}">
                                ${startupData.hookPitch || 'Set your one-line hook pitch to grab investor attention...'}
                            </p>
                        </div>
                        
<div style="margin-top: 2rem;">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                                <h4 style="font-size: 1.1rem; margin:0;">Pitch Deck</h4>
                                <button class="upload-btn" onclick="uploadPitchDeck()" style="margin:0; padding:0.5rem 1rem; font-size:0.85rem;">
                                    ${startupData.pitchDeckUrl ? 'Update Pitch' : 'Upload PDF'}
                                </button>
                            </div>

                            ${startupData.pitchDeckUrl 
                                ? `<div class="pitch-deck-row">
                                        <div class="pdf-thumbnail-container">
                                            <canvas id="pdf-thumb-canvas"></canvas>
                                        </div>
                                        <div class="pdf-details">
                                            <div class="pdf-filename">
                                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#ff006e" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                                                ${getFilenameFromUrl(startupData.pitchDeckUrl)}
                                            </div>
                                            <div class="pdf-filesize">PDF Document</div>
                                        </div>
                                        <button class="open-pitch-btn" onclick="openFullScreenPDF('${startupData.pitchDeckUrl}')">
                                            Open Pitch
                                        </button>
                                   </div>`
                                : `<div class="upload-section">
                                    <p style="color: #666;">No pitch deck uploaded yet</p>
                                   </div>`
                            }
                        </div>
                    </div>
                    
                    <div class="profile-card">
                        <h3 class="section-title">Startup Details</h3>
                        
                        <div class="description-box ${!startupData.description ? 'not-set' : ''}" style="margin-bottom: 1.5rem;">
                            ${startupData.description || 'Add a detailed description of your startup...'}
                        </div>
                        <button class="edit-icon-btn" onclick="editStartupDescription()" style="margin-bottom: 2rem;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </button>
                        
                        <div class="info-row">
                            <span class="info-label">Location</span>
                            <span class="info-value ${!startupData.location?.country ? 'not-set' : ''}">
                                ${startupData.location?.country 
                                    ? `${startupData.location.city || ''}, ${startupData.location.state || ''}, ${startupData.location.country}`
                                    : 'Not set'}
                            </span>
                        </div>
                        
                        <div class="info-row">
                            <span class="info-label">Year Established</span>
                            <span class="info-value ${!startupData.yearEstablished ? 'not-set' : ''}">
                                ${startupData.yearEstablished || 'Not set'}
                                ${startupData.yearEstablished ? '' : '<button class="edit-icon-btn" onclick="editYearEstablished()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button>'}
                            </span>
                        </div>
                        
                        <div class="info-row">
                            <span class="info-label">Category</span>
                            <span class="info-value">
                                ${startupData.category || 'Not set'}
                            </span>
                        </div>
                        
                        <div class="info-row">
                            <span class="info-label">Stage</span>
                            <span class="info-value">
                                ${startupData.stage || 'Not set'}
                                <button class="edit-icon-btn" onclick="editStage()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </span>
                        </div>
                    </div>
                    
                    <div class="profile-card">
                        <h3 class="section-title">Status & Metrics</h3>
                        
                        <div class="info-row">
                            <span class="info-label">Monetization Idea</span>
                            <span class="info-value ${!startupData.monetization ? 'not-set' : ''}">
                                ${startupData.monetization || 'Not set'}
                                <button class="edit-icon-btn" onclick="editMonetization()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </span>
                        </div>
                        
                        <div class="info-row">
                            <span class="info-label">Revenue</span>
                            <span class="info-value ${startupData.revenue === undefined ? 'not-set' : ''}">
                                ${startupData.revenue !== undefined ? `$${startupData.revenue.toLocaleString()}` : 'Not set'}
                                <button class="edit-icon-btn" onclick="editRevenue()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </span>
                        </div>
                        
                        <div class="info-row">
                            <span class="info-label">User Count</span>
                            <span class="info-value ${startupData.userCount === undefined ? 'not-set' : ''}">
                                ${startupData.userCount !== undefined ? startupData.userCount.toLocaleString() : 'Not set'}
                                <button class="edit-icon-btn" onclick="editUserCount()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </span>
                        </div>
                        
                        <div class="info-row">
                            <span class="info-label">Valuation</span>
                            <span class="info-value ${startupData.valuation === undefined ? 'not-set' : ''}">
                                ${startupData.valuation !== undefined ? `$${startupData.valuation.toLocaleString()}` : 'Not set'}
                                <button class="edit-icon-btn" onclick="editValuation()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </span>
                        </div>
                        
                        <div class="info-row">
                            <span class="info-label">Company Description</span>
                            <span class="info-value ${!startupData.companyDescription ? 'not-set' : ''}">
                                ${startupData.companyDescription || 'Not set'}
                                <button class="edit-icon-btn" onclick="editCompanyDescription()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </span>
                        </div>
                    </div>

                  <div class="profile-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 class="section-title" style="margin-bottom: 0;">Interest Tracking Photos (Optional)</h3>
                            <button class="upload-btn" onclick="uploadTractionPhotos()" style="margin: 0; padding: 0.5rem 1rem; font-size: 0.85rem;">
                                ${startupData.tractionPhotos?.length > 0 ? 'Add More Photos' : 'Upload Photos'}
                            </button>
                        </div>

                        <p style="color: #888; margin-bottom: 1.5rem; font-size: 0.95rem;">
                            Upload screenshots of transactions, user growth, or any proof of traction
                        </p>
                        
                        ${startupData.tractionPhotos?.length > 0 
                            ? `<div class="photo-grid">
                                ${startupData.tractionPhotos.map(url => `
                                    <div class="photo-item">
                                        <img src="${url}" alt="Traction Photo">
                                    </div>
                                `).join('')}
                               </div>`
                            : `<div class="upload-section">
                                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2" style="margin-bottom: 1rem;">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                    <polyline points="21 15 16 10 5 21"></polyline>
                                </svg>
                                <p style="color: #666;">No traction photos uploaded</p>
                               </div>`}
                    </div>

                    <div class="profile-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 class="section-title" style="margin-bottom: 0;">Team</h3>
                            <button class="edit-icon-btn" onclick="addTeamMember()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                        </div>
                        
                        <p style="color: #888; margin-bottom: 1.5rem; font-size: 0.95rem;">
                            Add co-founders and key team members to showcase your team's strength.
                        </p>

                        <div id="team-container">
                            ${teamListHTML}
                        </div>

                        <button class="add-item-btn" style="width: 100%; margin-top: 1.5rem;" onclick="addTeamMember()">
                            + Add Member
                        </button>
                    </div>

                </div> 
                <div class="profile-sidebar">

                    <div class="progress-card" style="margin-top: 2rem;">
                        <h3 class="section-title">Startup Profile Progress</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${startupPercent}%"></div>
                        </div>
                        <div class="progress-text">${startupPercent}%</div>
                        <p style="color: #888; font-size: 0.9rem; text-align: center; margin-top: 1rem;">
                            A complete startup profile attracts 3x more investors
                        </p>
                    </div>
                    <div class="quick-links-card">
                        <h3 class="section-title">Quick Actions</h3>
                        
                        <button class="quick-link-btn" onclick="previewProfile('${currentUser.uid}')">
                            <span style="display: flex; align-items: center; gap: 0.75rem;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                Preview Public Profile
                            </span>
                        </button>

                        <button class="quick-link-btn" onclick="copyShareLink()">
                            <span style="display: flex; align-items: center; gap: 0.75rem;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                                    <polyline points="16 6 12 2 8 6"></polyline>
                                    <line x1="12" y1="2" x2="12" y2="15"></line>
                                </svg>
                                Share Profile Link
                            </span>
                        </button>
                        
                        <button class="quick-link-btn" onclick="contactSupport()">
                            <span style="display: flex; align-items: center; gap: 0.75rem;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                </svg>
                                Help & Support
                            </span>
                        </button>
                    </div>
                </div> 
                </div> </div>
    `;
if(startupData.pitchDeckUrl) {
        setTimeout(() => {
            renderPdfThumbnail(startupData.pitchDeckUrl);
        }, 500);
    }
}
// --- 4. Team Members ---

window.addTeamMember = function() {
    const modal = document.createElement('div');
    modal.className = 'edit-modal'; 
    
    modal.innerHTML = `
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h3>Add Team Member</h3>
                <button class="modal-close" onclick="closeEditModal()">Ã—</button>
            </div>
            <div class="edit-modal-body">
                <div>
                    <label>Full Name</label>
                    <input type="text" id="tmName" placeholder="e.g. Sarah Smith">
                </div>
                <div>
                    <label>Role / Position</label>
                    <input type="text" id="tmRole" placeholder="e.g. CTO, Lead Marketing">
                </div>
                <div>
            </div>
            <div class="edit-modal-footer">
                <button class="modal-btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="modal-btn-save" onclick="saveTeamMember()">Add Member</button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Small delay to trigger the fade-in animation
    setTimeout(() => {
        modal.classList.add('show');
    }, 10);
    
    // Auto-focus the name field
    setTimeout(() => {
        document.getElementById('tmName').focus();
    }, 100);
};
window.saveTeamMember = async function() {
    const name = document.getElementById('tmName').value.trim();
    const role = document.getElementById('tmRole').value.trim();
    const link = document.getElementById('tmLink').value.trim();

    if (!name || !role) return alert("Name and Role are required");

    // Fetch existing team or initialize empty array
    let currentTeam = cachedStartupData?.team || [];
    
    // Add new member
    currentTeam.push({
        name: name,
        role: role,
        linkedin: link,
        addedAt: Date.now()
    });

    await updateStartupField({ team: currentTeam });
};
// ==========================================
//  STARTUP PROFILE EDIT LOGIC (Paste this!)
// ==========================================

// --- Helper: Save Changes to Firebase ---
async function updateStartupField(updates) {
    if (!currentUser) return;
    
    // Attempt to find the button that triggered the save to show loading state
    const saveBtn = document.querySelector('.modal-btn-save');
    const originalText = saveBtn ? saveBtn.innerHTML : 'Save';
    if(saveBtn) {
        saveBtn.innerHTML = 'Saving...';
        saveBtn.disabled = true;
    }

    try {
        // Update Firebase
        const startupRef = ref(db, `startupProfile/${currentUser.uid}`);
        await update(startupRef, updates);
        
        // Update Local Cache
        if (cachedStartupData) {
            cachedStartupData = { ...cachedStartupData, ...updates };
        } else {
            cachedStartupData = updates;
        }
        
        // Close Modal and Refresh View
        closeEditModal();
        showEditStartup(); 
        
    } catch (error) {
        console.error("Error updating startup profile:", error);
        alert("Failed to save changes. Please try again.");
        if(saveBtn) {
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
        }
    }
}

// --- 1. Basic Text Edits ---

window.editStartupName = function() {
    currentEditAction = (value) => {
        if(!value) return alert("Name cannot be empty");
        updateStartupField({ startupName: value });
    };
    createEditModal("Edit Startup Name", cachedStartupData?.startupName || "", "Enter startup name");
};

window.editStartupDescription = function() {
    currentEditAction = (value) => {
        updateStartupField({ description: value }); // Note: mapped to 'description'
    };
    createEditModal("Edit Description", cachedStartupData?.description || "", "Describe your startup...", true); // true = textarea
};

window.editHookPitch = function() {
    currentEditAction = (value) => {
        updateStartupField({ hookPitch: value });
    };
    createEditModal("Edit Hook Pitch", cachedStartupData?.hookPitch || "", "One-liner that grabs attention");
};

window.editCompanyDescription = function() {
    currentEditAction = (value) => {
        updateStartupField({ companyDescription: value });
    };
    createEditModal("Detailed Description", cachedStartupData?.companyDescription || "", "Full details about your company...", true);
};

window.editStage = function() {
    currentEditAction = (value) => {
        updateStartupField({ stage: value });
    };
    createEditModal("Startup Stage", cachedStartupData?.stage || "", "e.g., Idea, MVP, Pre-Seed, Series A");
};

window.editYearEstablished = function() {
    currentEditAction = (value) => {
        updateStartupField({ yearEstablished: value });
    };
    createEditModal("Year Established", cachedStartupData?.yearEstablished || "", "YYYY");
};

// --- 2. Financials & Metrics (Numbers) ---

window.editMonetization = function() {
    currentEditAction = (value) => {
        updateStartupField({ monetization: value });
    };
    createEditModal("Monetization Model", cachedStartupData?.monetization || "", "e.g., SaaS Subscription, Ads");
};

window.editRevenue = function() {
    currentEditAction = (value) => {
        // Strip currency symbols and commas before saving
        const cleanValue = value.replace(/[$,]/g, ''); 
        const numValue = parseFloat(cleanValue);
        if(isNaN(numValue)) return alert("Please enter a valid number");
        updateStartupField({ revenue: numValue });
    };
    createEditModal("Revenue (USD)", cachedStartupData?.revenue || "0", "Enter amount");
};

window.editUserCount = function() {
    currentEditAction = (value) => {
        const cleanValue = value.replace(/[,]/g, '');
        const numValue = parseInt(cleanValue);
        if(isNaN(numValue)) return alert("Please enter a valid number");
        updateStartupField({ userCount: numValue });
    };
    createEditModal("User Count", cachedStartupData?.userCount || "0", "Enter number of users");
};

window.editValuation = function() {
    currentEditAction = (value) => {
        const cleanValue = value.replace(/[$,]/g, '');
        const numValue = parseFloat(cleanValue);
        if(isNaN(numValue)) return alert("Please enter a valid number");
        updateStartupField({ valuation: numValue });
    };
    createEditModal("Valuation (USD)", cachedStartupData?.valuation || "0", "Enter amount");
};

// --- 3. File Upload Functions ---

window.editStartupLogo = function() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    
    input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // Show simplified loading
        const btn = document.querySelector('.startup-logo-large');
        if(btn) btn.style.opacity = '0.5';

        try {
            const logoUrl = await uploadFileToStorage(file, 'startup-logos');
            await updateStartupField({ logo: logoUrl });
        } catch (error) {
            console.error(error);
            alert("Logo upload failed");
        } finally {
            if(btn) btn.style.opacity = '1';
        }
    };
    input.click();
};

window.uploadPitchDeck = function() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.pdf'; 
    
    input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // SHOW SPECIAL ANIMATION
        showSpecialUploadAnimation("Uploading Pitch Deck...");

        try {
            const deckUrl = await uploadFileToStorage(file, 'pitch-decks');
            await updateStartupField({ pitchDeckUrl: deckUrl });
            hideSpecialUploadAnimation();
        } catch (error) {
            console.error(error);
            hideSpecialUploadAnimation();
            alert("Upload failed. Please try again.");
        }
    };
    input.click();
};
window.uploadTractionPhotos = function() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.multiple = true; 
    
    input.onchange = async (e) => {
        const files = Array.from(e.target.files);
        if (files.length === 0) return;

        showSpecialUploadAnimation(`Uploading ${files.length} Photos...`);

        try {
            const uploadPromises = files.map(file => uploadFileToStorage(file, 'traction-photos'));
            const newUrls = await Promise.all(uploadPromises);
            
            const existingPhotos = cachedStartupData?.tractionPhotos || [];
            const updatedPhotos = [...existingPhotos, ...newUrls];
            
            await updateStartupField({ tractionPhotos: updatedPhotos });
            hideSpecialUploadAnimation();
        } catch (error) {
            console.error(error);
            hideSpecialUploadAnimation();
            alert("Photo upload failed");
        }
    };
    input.click();
};

function showSpecialUploadAnimation(text) {
    // Check if overlay exists, if not create it
    let overlay = document.getElementById('specialUploadOverlay');
    if (!overlay) {
        overlay = document.createElement('div');
        overlay.id = 'specialUploadOverlay';
        overlay.className = 'special-upload-overlay';
        overlay.innerHTML = `
            <div class="pulse-ring">
                <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
            </div>
            <div class="upload-status-text" id="specialUploadText">${text}</div>
            <div style="color: #888; font-size: 0.9rem;">Please wait while we process...</div>
        `;
        document.body.appendChild(overlay);
    } else {
        document.getElementById('specialUploadText').textContent = text;
    }
    
    // Trigger Animation
    setTimeout(() => overlay.classList.add('active'), 10);
}

function hideSpecialUploadAnimation() {
    const overlay = document.getElementById('specialUploadOverlay');
    if (overlay) {
        overlay.classList.remove('active');
        setTimeout(() => overlay.remove(), 400);
    }
}
function getFilenameFromUrl(url) {
    try {
        // Decode URI to handle Firebase tokens and special chars
        const decoded = decodeURIComponent(url);
        // Extract content after the last slash
        const basename = decoded.split('/').pop().split('?')[0];
        // Remove timestamp prefix if you used one (e.g., 123456_file.pdf)
        return basename.replace(/^\d+_/, '');
    } catch(e) {
        return "Pitch Deck.pdf";
    }
}

// Render Thumbnail using PDF.js
async function renderPdfThumbnail(url) {
    const canvas = document.getElementById('pdf-thumb-canvas');
    if(!canvas) return;

    try {
        const loadingTask = pdfjsLib.getDocument(url);
        const pdf = await loadingTask.promise;
        const page = await pdf.getPage(1); // Get page 1

        const viewport = page.getViewport({ scale: 0.5 }); // Scale down
        const context = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        const renderContext = {
            canvasContext: context,
            viewport: viewport
        };
        await page.render(renderContext).promise;
    } catch (error) {
        console.error("Error rendering PDF thumb:", error);
        // Fallback visual if rendering fails (e.g. CORS issue)
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#222';
        ctx.fillRect(0,0,canvas.width, canvas.height);
        ctx.fillStyle = '#fff';
        ctx.font = '10px Arial';
        ctx.fillText("PDF", 10, 50);
    }
}

// --- FULL SCREEN VIEWER ---
window.openFullScreenPDF = function(url) {
    // Create viewer container
    const viewer = document.createElement('div');
    viewer.className = 'full-screen-viewer';
    viewer.innerHTML = `
        <div class="viewer-header">
            <button class="viewer-back-btn" onclick="closeFullScreenPDF()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5"></path>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                Back
            </button>
            <span style="color:#fff; font-weight:600;">Pitch Deck Preview</span>
            <div style="width:60px;"></div> </div>
        <div class="viewer-content">
            <iframe src="${url}" style="width:100%; height:100%; border:none;"></iframe>
        </div>
    `;
    document.body.appendChild(viewer);
    
    // Animation in
    setTimeout(() => viewer.classList.add('active'), 10);
};

window.closeFullScreenPDF = function() {
    const viewer = document.querySelector('.full-screen-viewer');
    if (viewer) {
        viewer.classList.remove('active');
        setTimeout(() => viewer.remove(), 300);
    }
};




</script>
<!-- FOUNDER DASHBOARD -->
<div id="dashboardContainer" style="display: none;"></div>
</body>
</html>
