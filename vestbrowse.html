<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Vests | ScaleVest Terminal</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a2f23 0%, #0f172a 100%);
            color: #fff;
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container { max-width: 1400px; margin: 0 auto; }

        .header-area { 
            margin-bottom: 50px; 
            text-align: center; 
            animation: fadeInDown 0.8s ease;
        }
        
        .header-area h1 { 
            font-size: 3.5rem; 
            font-weight: 800;
            background: linear-gradient(90deg, #10b981, #3b82f6); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
            letter-spacing: -2px;
        }

        .cards-wrapper {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
        }

        /* FIVERR GIG STYLE CARD */
        .card {
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            cursor: pointer;
            height: 380px;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(16, 185, 129, 0.3);
        }

        .thumbnail-area {
            height: 180px;
            width: 100%;
            position: relative;
            background: #000;
            overflow: hidden;
        }

        .thumbnail-area img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .card:hover .thumbnail-area img {
            transform: scale(1.08);
        }

        .card-content {
            padding: 16px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .hook-text {
            color: #1a1a1a;
            font-size: 15px;
            font-weight: 600;
            line-height: 1.4;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 42px;
        }

        .startup-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .startup-logo {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            color: white;
        }

        .startup-name {
            font-size: 14px;
            font-weight: 700;
            color: #374151;
        }

        .card-footer {
            margin-top: auto;
            padding-top: 12px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .fund-ask {
            font-size: 13px;
            color: #6b7280;
        }

        .fund-amount {
            font-size: 15px;
            font-weight: 700;
            color: #10b981;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .analyze-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        #noVests { 
            text-align: center; 
            width: 100%; 
            padding: 100px; 
            color: #10b981; 
            font-weight: 700; 
            font-size: 1.2rem; 
            display: none; 
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .cards-wrapper {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }
            .header-area h1 { font-size: 2.5rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-area">
        <h1>Investment Terminal</h1>
        <p style="color: #94a3b8; margin-top: 10px;">Direct access to verified high-growth startup equity.</p>
    </div>

    <div id="noVests">INITIALIZING TERMINAL...</div>
    
    <div class="cards-wrapper" id="vestsContainer"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD6PdrKp2XLfRqjC587lMpdKTaWD4MBens",
        authDomain: "scalevest-163a0.firebaseapp.com",
        databaseURL: "https://scalevest-163a0-default-rtdb.firebaseio.com",
        projectId: "scalevest-163a0",
        storageBucket: "scalevest-163a0.firebasestorage.app",
        messagingSenderId: "938358950124",
        appId: "1:938358950124:web:043506aeaacea2a96bfdc9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    onAuthStateChanged(auth, (user) => {
        if (user) {
            loadVests();
        } else {
            window.location.href = "login3.html";
        }
    });

    async function loadVests() {
        const container = document.getElementById('vestsContainer');
        const noVestsMsg = document.getElementById('noVests');
        
        try {
            const vestRef = ref(db, "Vests");
            const snapshot = await get(vestRef);

            if (!snapshot.exists()) {
                noVestsMsg.innerText = "NO ACTIVE OPPORTUNITIES IN TERMINAL.";
                noVestsMsg.style.display = "block";
                return;
            }

            container.innerHTML = "";
            let activeCount = 0;

            snapshot.forEach((userNode) => {
                const ownerUID = userNode.key;
                
                userNode.forEach((vest) => {
                    const vestData = vest.val();
                    const vestID = vest.key;

                    if (vestData.status === "active") {
                        activeCount++;
                        
                        const main = vestData.MainVest || {};
                        const details = vestData.StartupDetails || {};
                        const startupName = details.name || 'Premium Startup';
                        const initials = startupName.split(' ').map(w => w[0]).join('').substring(0, 2).toUpperCase();

                        const cardHtml = `
                            <div class="card" onclick="window.location.href='vest-details.html?id=${vestID}&owner=${ownerUID}'">
                                <div class="thumbnail-area">
                                    <img src="${main.thumbnailUrl || 'https://images.unsplash.com/photo-1551434678-e076c223a692?w=800'}" alt="Preview">
                                </div>
                                <div class="card-content">
                                    <div class="hook-text">${main.hook || 'Next-Gen Innovation Opportunity Available'}</div>
                                    <div class="startup-info">
                                        <div class="startup-logo">${initials}</div>
                                        <div class="startup-name">${startupName}</div>
                                    </div>
                                    <div class="card-footer">
                                        <div>
                                            <div class="fund-ask">Funding Ask</div>
                                            <div class="fund-amount">$${main.fundAsk || '50K'}</div>
                                        </div>
                                        <button class="analyze-btn" onclick="event.stopPropagation(); window.location.href='vest-details.html?id=${vestID}&owner=${ownerUID}'">
                                            Analyze â†’
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                        container.innerHTML += cardHtml;
                    }
                });
            });

            if (activeCount === 0) {
                noVestsMsg.innerText = "NO ACTIVE OPPORTUNITIES IN TERMINAL.";
                noVestsMsg.style.display = "block";
            } else {
                noVestsMsg.style.display = "none";
            }

        } catch (err) {
            console.error("Load Error:", err);
            noVestsMsg.innerText = "PERMISSION DENIED: CHECK FIREBASE RULES.";
            noVestsMsg.style.display = "block";
        }
    }
</script>

</body>
</html>
