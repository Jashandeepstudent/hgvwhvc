<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultra Barcode Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #111;
  color: #fff;
  font-family: Inter, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}

#scanner {
  position: relative;
  width: 100%;
  max-width: 600px;
  height: 420px;
  border-radius: 18px;
  overflow: hidden;
  border: 3px solid #00ff55;
}

video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.scan-box {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 10%;
  right: 10%;
  border: 3px dashed #00ff55;
  z-index: 5;
}

.laser {
  position: absolute;
  width: 100%;
  height: 3px;
  background: red;
  box-shadow: 0 0 15px red;
  animation: scan 1s linear infinite;
  z-index: 6;
}

@keyframes scan {
  0% { top: 0; }
  50% { top: 100%; }
  100% { top: 0; }
}

#log {
  margin-top: 15px;
  width: 100%;
  max-width: 600px;
  background: #222;
  padding: 10px;
  border-radius: 12px;
  min-height: 120px;
  overflow-y: auto;
}

button {
  margin-top: 12px;
  padding: 12px 20px;
  border-radius: 14px;
  border: none;
  font-weight: bold;
  cursor: pointer;
  background: #00ff55;
  color: black;
}
</style>
</head>

<body>

<h2>ðŸ”¥ REAL Barcode Scanner (ZXing)</h2>

<div id="scanner">
  <video id="video" autoplay muted playsinline></video>
  <div class="scan-box"></div>
  <div class="laser"></div>
</div>

<div id="log"></div>

<button onclick="startScanner()">START</button>
<button onclick="stopScanner()">STOP</button>

<script type="module">
import {
  BrowserMultiFormatReader
} from "https://cdn.jsdelivr.net/npm/@zxing/browser@0.0.10/esm/index.min.js";

let codeReader;
let lastScan = 0;
let lastCode = "";

function log(msg) {
  const div = document.createElement("div");
  div.textContent = `${new Date().toLocaleTimeString()} â†’ ${msg}`;
  document.getElementById("log").prepend(div);
}

async function startScanner() {
  codeReader = new BrowserMultiFormatReader();

  const video = document.getElementById("video");

  try {
    const devices = await navigator.mediaDevices.enumerateDevices();
    const camera = devices.find(d => d.kind === "videoinput" && d.label.toLowerCase().includes("back"))
                  || devices.find(d => d.kind === "videoinput");

    await codeReader.decodeFromVideoDevice(
      camera?.deviceId,
      video,
      (result, err) => {
        if (result) {
          const now = Date.now();

          if (result.text === lastCode && now - lastScan < 1200) return;

          lastCode = result.text;
          lastScan = now;

          log(`âœ… SCANNED: ${result.text}`);
        }
      }
    );
  } catch (err) {
    alert("Camera error: " + err);
  }
}

function stopScanner() {
  if (codeReader) {
    codeReader.reset();
    log("â›” Scanner stopped");
  }
}
</script>

</body>
</html>
